import{x as j,j as e,r as a,B as d,T as t,V as W,W as w,P as x,b as V,C,m as h}from"./index-D1WZwRG5.js";import{S as c}from"./Stack-BDxuP9_X.js";import{R as _}from"./Refresh-DrNglfqJ.js";import{B as $}from"./Button-BhZ-lD3l.js";import{F as G}from"./FileDownload-xGpG_pRF.js";import{G as m}from"./Grid-DMeR_RpR.js";import{C as D}from"./Chip-BcfuiGLT.js";import{D as H}from"./Drawer-7E5gQ_7V.js";import{T as K,a as M,b as N,c as S,d as r,e as U}from"./TableRow-CbZqZsXt.js";import{S as q}from"./Snackbar-8yKmYgF-.js";import{A as J}from"./Alert-C2uN4Clt.js";const Q=j(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),X=j(e.jsx("path",{d:"m16 18 2.29-2.29-4.88-4.88-4 4L2 7.41 3.41 6l6 6 4-4 6.3 6.29L22 12v6z"}),"TrendingDown"),Y=j(e.jsx("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),de=()=>{const[u,f]=a.useState(!0),[I,R]=a.useState([]),[T,B]=a.useState([]),[n,k]=a.useState({asOfDate:new Date().toISOString().slice(0,10),accountId:null,status:["open","partial","overdue"]}),[z,p]=a.useState(!1),[g,O]=a.useState(null),[P,E]=a.useState([]),[F,v]=a.useState(!1),[o,i]=a.useState({open:!1,message:"",severity:"success"}),b=async()=>{f(!0);try{const[s,l]=await Promise.all([h.receivables.getKpis(n),h.receivables.getAgingBuckets(n)]);R(s.data||[]),B(l.data||[])}catch(s){i({open:!0,message:s.message||"Erro ao carregar recebíveis",severity:"error"})}finally{f(!1)}};a.useEffect(()=>{b()},[n]);const L=async s=>{O(s),p(!0),v(!0);try{const l=await h.receivables.getAgingDetails(s,n);E(l.data||[])}catch(l){i({open:!0,message:l.message,severity:"error"})}finally{v(!1)}},A=async()=>{try{const s=await h.receivables.requestReceivablesExport("csv");i({open:!0,message:s.message||"Exportação solicitada",severity:"success"})}catch(s){i({open:!0,message:s.message,severity:"error"})}},y=s=>`R$ ${s.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`;return e.jsxs(d,{sx:{p:3},children:[e.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[e.jsx(t,{variant:"h4",fontWeight:700,children:"Painel de Recebíveis"}),e.jsxs(c,{direction:"row",spacing:1,children:[e.jsx(W,{title:"Recarregar",children:e.jsx(w,{onClick:b,disabled:u,children:e.jsx(_,{})})}),e.jsx($,{startIcon:e.jsx(G,{}),onClick:A,children:"Exportar"})]})]}),e.jsx(x,{sx:{p:2,mb:2},children:e.jsx(c,{direction:"row",spacing:2,flexWrap:"wrap",children:e.jsx(V,{label:"Data de corte",type:"date",size:"small",sx:{minWidth:180},InputLabelProps:{shrink:!0},value:n.asOfDate,onChange:s=>k({...n,asOfDate:s.target.value})})})}),u?e.jsx(d,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(C,{})}):e.jsxs(e.Fragment,{children:[e.jsx(m,{container:!0,spacing:2,sx:{mb:3},children:I.map(s=>e.jsx(m,{item:!0,xs:12,md:6,lg:3,children:e.jsxs(x,{sx:{p:2},children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:s.label}),e.jsx(t,{variant:"h5",fontWeight:700,sx:{my:1},children:s.formattedValue}),s.comparison&&e.jsxs(c,{direction:"row",spacing:.5,alignItems:"center",children:[s.comparison.deltaPct>=0?e.jsx(Y,{fontSize:"small",color:"error"}):e.jsx(X,{fontSize:"small",color:"success"}),e.jsxs(t,{variant:"caption",color:s.comparison.deltaPct>=0?"error.main":"success.main",children:[Math.abs(s.comparison.deltaPct).toFixed(1),"% ",s.comparison.label]})]})]})},s.key))}),e.jsxs(x,{sx:{p:3},children:[e.jsx(t,{variant:"h6",sx:{mb:2},children:"Aging de Recebíveis (por dias em atraso)"}),e.jsx(m,{container:!0,spacing:2,children:T.map(s=>e.jsx(m,{item:!0,xs:12,md:6,lg:3,children:e.jsxs(x,{variant:"outlined",sx:{p:2,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>L(s.bucket),children:[e.jsxs(t,{variant:"caption",color:"text.secondary",children:[s.label," dias"]}),e.jsx(t,{variant:"h6",fontWeight:700,children:y(s.amountOpen)}),e.jsx(D,{label:`${s.invoicesCount} faturas`,size:"small",sx:{mt:1}})]})},s.bucket))})]})]}),e.jsx(H,{anchor:"right",open:z,onClose:()=>p(!1),children:e.jsxs(d,{sx:{width:700,p:3},children:[e.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(t,{variant:"h6",children:["Detalhes do bucket:"," ",g==="0_30"?"0–30 dias":g==="31_60"?"31–60 dias":g==="61_90"?"61–90 dias":"90+ dias"]}),e.jsx(w,{onClick:()=>p(!1),children:e.jsx(Q,{})})]}),F?e.jsx(d,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(C,{})}):e.jsx(K,{children:e.jsxs(M,{size:"small",children:[e.jsx(N,{children:e.jsxs(S,{children:[e.jsx(r,{children:"Fatura"}),e.jsx(r,{children:"Empresa"}),e.jsx(r,{children:"Vencimento"}),e.jsx(r,{align:"right",children:"Dias"}),e.jsx(r,{align:"right",children:"Saldo"})]})}),e.jsx(U,{children:P.map(s=>e.jsxs(S,{hover:!0,children:[e.jsx(r,{children:s.invoiceNumber}),e.jsx(r,{children:s.accountName}),e.jsx(r,{children:s.dueDate}),e.jsx(r,{align:"right",children:e.jsx(D,{label:s.daysOverdue,size:"small",color:"error"})}),e.jsx(r,{align:"right",sx:{fontWeight:700},children:y(s.amountOpen)})]},s.invoiceId))})]})})]})}),e.jsx(q,{open:o.open,autoHideDuration:4e3,onClose:()=>i({...o,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(J,{severity:o.severity,variant:"filled",onClose:()=>i({...o,open:!1}),children:o.message})})]})};export{de as default};
