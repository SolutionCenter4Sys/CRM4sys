import{x as B,j as e,r as o,B as x,T as r,P as c,C as J,F as I,I as T,S as E,b as S,D as K,W as Q,m as p}from"./index-D1WZwRG5.js";import{B as f}from"./Button-BhZ-lD3l.js";import{A as P}from"./Add-CgRR7ozh.js";import{A as N}from"./Alert-C2uN4Clt.js";import{S as d}from"./Stack-BDxuP9_X.js";import{M as b}from"./MenuItem-C9hTkJKZ.js";import{C as l}from"./Chip-BcfuiGLT.js";import{S as X}from"./Switch-axFPc32Z.js";import{C as Y,a as Z}from"./CardContent-C09eNwcx.js";import{D as ee}from"./DeleteOutline-CoTBT85l.js";import{S as se}from"./Snackbar-8yKmYgF-.js";import"./SwitchBase-TQvPBqmb.js";const ae=B(e.jsx("path",{d:"M10 8.64 15.27 12 10 15.36zM8 5v14l11-7z"}),"PlayArrowOutlined"),te=B(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm2 16H5V5h11.17L19 7.83zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3M6 6h9v4H6z"}),"SaveOutlined"),ne={email:"Email",task:"Task",wait:"Wait"},A=[{id:"tpl-crm-guide",name:"Guia de CRM",preview:"OlÃ¡, {{firstName}}. Separamos um guia prÃ¡tico para acelerar seu funil comercial."},{id:"tpl-case-study",name:"Case Study",preview:"Veja como uma empresa semelhante aumentou em 37% as conversÃµes com nosso playbook."},{id:"tpl-demo-offer",name:"Convite para Demo",preview:"Podemos mostrar uma demo de 20 minutos com foco no seu cenÃ¡rio atual."}],ve=()=>{const[R,z]=o.useState(!0),[k,u]=o.useState(null),[w,h]=o.useState({open:!1,message:"",severity:"info"}),[C,H]=o.useState([]),[j,q]=o.useState(""),[n,m]=o.useState(null),[D,W]=o.useState([]),g=async()=>{var s;try{z(!0),u(null);const a=(await p.nurtureSequences.list()).data||[];H(a);const i=j||((s=a[0])==null?void 0:s.id)||"";q(i),m(a.find(y=>y.id===i)||null)}catch(t){u(t instanceof Error?t.message:"Erro ao carregar sequÃªncias")}finally{z(!1)}};o.useEffect(()=>{g()},[]);const $=o.useMemo(()=>C.find(s=>s.id===j)||null,[C,j]);o.useEffect(()=>{m($)},[$]);const M=async s=>{if(!s){W([]);return}const t=await p.nurtureSequences.listTestRuns(s);W(t.data||[])};o.useEffect(()=>{M(j)},[j]);const v=(s,t)=>{m(a=>a&&{...a,steps:a.steps.map(i=>i.id===s?t(i):i)})},L=()=>{m(s=>{if(!s)return s;const t={id:`${Date.now()}-step`,order:s.steps.length+1,type:"email",delayDays:3,delayHours:0,emailSubject:"Novo passo de nutriÃ§Ã£o"};return{...s,steps:[...s.steps,t]}})},O=s=>{m(t=>t&&{...t,steps:t.steps.filter(a=>a.id!==s).map((a,i)=>({...a,order:i+1}))})},F=async()=>{if(n)try{u(null),await p.nurtureSequences.save(n),h({open:!0,message:"SequÃªncia salva com sucesso",severity:"success"}),await g()}catch(s){u(s instanceof Error?s.message:"Erro ao salvar sequÃªncia")}},V=async()=>{try{const s=await p.nurtureSequences.create(`Nova sequÃªncia ${new Date().toLocaleTimeString("pt-BR")}`);s.data&&q(s.data.id),h({open:!0,message:"SequÃªncia criada com sucesso",severity:"success"}),await g()}catch(s){u(s instanceof Error?s.message:"Erro ao criar sequÃªncia")}},G=async()=>{if(n)try{await p.nurtureSequences.delete(n.id),await g(),h({open:!0,message:"SequÃªncia removida",severity:"success"})}catch(s){u(s instanceof Error?s.message:"Erro ao remover sequÃªncia")}},U=async()=>{if(n)try{const s=await p.nurtureSequences.testSequence(n.id);h({open:!0,message:s.message||"Teste disparado",severity:"info"}),await M(n.id)}catch(s){u(s instanceof Error?s.message:"Erro ao testar sequÃªncia")}};return e.jsxs(x,{sx:{p:3},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(x,{children:[e.jsx(r,{variant:"h4",sx:{fontWeight:700},children:"ðŸ“§ Nurture Sequences"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Builder visual MVP para campanhas drip com passos e delays."})]}),e.jsx(f,{variant:"contained",startIcon:e.jsx(P,{}),onClick:V,children:"Nova SequÃªncia"})]}),k&&e.jsx(N,{severity:"error",sx:{mb:2},onClose:()=>u(null),children:k}),R?e.jsx(c,{sx:{p:6,textAlign:"center"},children:e.jsx(J,{})}):e.jsxs(d,{direction:{xs:"column",lg:"row"},spacing:2,children:[e.jsxs(c,{sx:{width:{xs:"100%",lg:320},p:2},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1},children:"SequÃªncias"}),e.jsxs(I,{fullWidth:!0,size:"small",children:[e.jsx(T,{children:"SequÃªncia ativa"}),e.jsx(E,{value:j,label:"SequÃªncia ativa",onChange:s=>q(s.target.value),children:C.map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))})]}),n&&e.jsxs(x,{sx:{mt:2},children:[e.jsx(l,{label:n.isActive?"Ativa":"Inativa",color:n.isActive?"success":"default",size:"small",sx:{mr:1}}),e.jsx(l,{label:`${n.stats.enrollments} enrollments`,size:"small",variant:"outlined"})]})]}),e.jsx(x,{sx:{flex:1},children:n?e.jsxs(d,{spacing:2,children:[e.jsx(c,{sx:{p:2},children:e.jsxs(d,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",children:[e.jsx(S,{size:"small",label:"Nome da sequÃªncia",value:n.name,fullWidth:!0,onChange:s=>m(t=>t&&{...t,name:s.target.value})}),e.jsxs(d,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(r,{variant:"caption",children:"Ativa"}),e.jsx(X,{checked:n.isActive,onChange:s=>m(t=>t&&{...t,isActive:s.target.checked})})]}),e.jsx(f,{startIcon:e.jsx(te,{}),variant:"contained",onClick:F,children:"Salvar"}),e.jsx(f,{startIcon:e.jsx(ae,{}),variant:"outlined",onClick:U,children:"Test Sequence"}),e.jsx(f,{color:"error",variant:"outlined",onClick:G,children:"Excluir"})]})}),e.jsxs(c,{sx:{p:2},children:[e.jsxs(d,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:700},children:"Workflow Builder"}),e.jsx(f,{variant:"outlined",startIcon:e.jsx(P,{}),onClick:L,children:"Adicionar Step"})]}),e.jsx(K,{sx:{mb:2}}),e.jsx(d,{spacing:1.5,children:n.steps.map(s=>{var t;return e.jsx(Y,{variant:"outlined",children:e.jsxs(Z,{children:[e.jsxs(d,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",children:[e.jsx(l,{label:`Step ${s.order}`,size:"small"}),e.jsxs(I,{size:"small",sx:{minWidth:140},children:[e.jsx(T,{children:"Tipo"}),e.jsx(E,{label:"Tipo",value:s.type,onChange:a=>v(s.id,i=>({...i,type:a.target.value})),children:Object.entries(ne).map(([a,i])=>e.jsx(b,{value:a,children:i},a))})]}),e.jsx(S,{size:"small",type:"number",label:"Delay (dias)",value:s.delayDays,onChange:a=>v(s.id,i=>({...i,delayDays:Number(a.target.value)})),sx:{width:120}}),e.jsx(S,{size:"small",type:"number",label:"Delay (horas)",value:s.delayHours||0,onChange:a=>v(s.id,i=>({...i,delayHours:Number(a.target.value)})),sx:{width:130}}),e.jsx(S,{size:"small",label:"Assunto Email",value:s.emailSubject||"",onChange:a=>v(s.id,i=>({...i,emailSubject:a.target.value})),sx:{flex:1}}),s.type==="email"&&e.jsxs(I,{size:"small",sx:{minWidth:180},children:[e.jsx(T,{children:"Template"}),e.jsxs(E,{label:"Template",value:s.emailTemplateId||"",onChange:a=>v(s.id,i=>{var y;return{...i,emailTemplateId:a.target.value,emailSubject:i.emailSubject||((y=A.find(_=>_.id===a.target.value))==null?void 0:y.name)}}),children:[e.jsx(b,{value:"",children:"Selecionar..."}),A.map(a=>e.jsx(b,{value:a.id,children:a.name},a.id))]})]}),e.jsx(Q,{color:"error",onClick:()=>O(s.id),children:e.jsx(ee,{})})]}),s.type==="email"&&s.emailTemplateId&&e.jsxs(c,{variant:"outlined",sx:{mt:1,p:1.2,bgcolor:"grey.50"},children:[e.jsx(r,{variant:"caption",sx:{fontWeight:700,display:"block"},children:"Preview de template"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:((t=A.find(a=>a.id===s.emailTemplateId))==null?void 0:t.preview)||"Template sem preview"})]}),s.stats&&e.jsxs(x,{sx:{mt:1,display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(l,{label:`Enviados: ${s.stats.sent}`,size:"small",variant:"outlined"}),e.jsx(l,{label:`Open: ${s.stats.sent?(s.stats.opened/s.stats.sent*100).toFixed(1):"0"}%`,size:"small",variant:"outlined"}),e.jsx(l,{label:`Clicks: ${s.stats.clicked}`,size:"small",variant:"outlined"})]})]})},s.id)})})]}),e.jsxs(c,{sx:{p:2},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1},children:"Performance"}),e.jsxs(x,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(l,{label:`Enrollments: ${n.stats.enrollments}`}),e.jsx(l,{label:`Ativos: ${n.stats.active}`}),e.jsx(l,{label:`Completos: ${n.stats.completed}`}),e.jsx(l,{label:`Unsubscribed: ${n.stats.unsubscribed}`}),e.jsx(l,{label:`ConversÃµes: ${n.stats.conversions}`,color:"success"}),e.jsx(l,{label:`Taxa: ${n.stats.overallConversionRate}%`,color:"success",variant:"outlined"})]})]}),e.jsxs(c,{sx:{p:2},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1},children:"HistÃ³rico de testes simulados"}),D.length===0?e.jsx(r,{variant:"body2",color:"text.secondary",children:"Nenhum teste executado ainda."}):e.jsx(d,{spacing:1,children:D.slice(0,8).map(s=>e.jsxs(c,{variant:"outlined",sx:{p:1},children:[e.jsxs(d,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",sx:{fontWeight:700},children:new Date(s.startedAt).toLocaleString("pt-BR")}),e.jsx(l,{size:"small",label:s.status,color:s.status==="delivered"?"success":s.status==="sent"?"info":"warning"})]}),e.jsx(r,{variant:"caption",color:"text.secondary",children:s.message})]},s.id))})]})]}):e.jsx(c,{sx:{p:4},children:e.jsx(r,{children:"Selecione uma sequÃªncia para editar."})})})]}),e.jsx(se,{open:w.open,autoHideDuration:2600,onClose:()=>h(s=>({...s,open:!1})),children:e.jsx(N,{severity:w.severity,onClose:()=>h(s=>({...s,open:!1})),sx:{width:"100%"},children:w.message})})]})};export{ve as default};
