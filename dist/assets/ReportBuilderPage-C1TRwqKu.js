import{r as c,g as T,d as U,e as _,_ as E,f as m,j as t,i as W,l as V,s as y,x as te,ac as ne,k as ae,u as re,Z as se,B as D,T as P,b as B,F as G,I as J,S as O,m as A}from"./index-D1WZwRG5.js";import{B as k}from"./Button-BhZ-lD3l.js";import{A as le}from"./Alert-C2uN4Clt.js";import{C as Q,a as X}from"./CardContent-C09eNwcx.js";import{S as F}from"./Stack-BDxuP9_X.js";import{M as C}from"./MenuItem-C9hTkJKZ.js";import{S as ie}from"./Switch-axFPc32Z.js";import"./SwitchBase-TQvPBqmb.js";const H=c.createContext({}),K=c.createContext({});function ce(e){return T("MuiStep",e)}U("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const de=["active","children","className","component","completed","disabled","expanded","index","last"],pe=e=>{const{classes:a,orientation:n,alternativeLabel:s,completed:l}=e;return V({root:["root",n,s&&"alternativeLabel",l&&"completed"]},ce,a)},ue=y("div",{name:"MuiStep",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.completed&&a.completed]}})(({ownerState:e})=>m({},e.orientation==="horizontal"&&{paddingLeft:8,paddingRight:8},e.alternativeLabel&&{flex:1,position:"relative"})),ve=c.forwardRef(function(a,n){const s=_({props:a,name:"MuiStep"}),{active:l,children:p,className:b,component:v="div",completed:x,disabled:f,expanded:d=!1,index:i,last:S}=s,u=E(s,de),{activeStep:h,connector:j,alternativeLabel:w,orientation:I,nonLinear:M}=c.useContext(H);let[o=!1,r=!1,g=!1]=[l,x,f];h===i?o=l!==void 0?l:!0:!M&&h>i?r=x!==void 0?x:!0:!M&&h<i&&(g=f!==void 0?f:!0);const R=c.useMemo(()=>({index:i,last:S,expanded:d,icon:i+1,active:o,completed:r,disabled:g}),[i,S,d,o,r,g]),L=m({},s,{active:o,orientation:I,alternativeLabel:w,completed:r,disabled:g,expanded:d,component:v}),z=pe(L),$=t.jsxs(ue,m({as:v,className:W(z.root,b),ref:n,ownerState:L},u,{children:[j&&w&&i!==0?j:null,p]}));return t.jsx(K.Provider,{value:R,children:j&&!w&&i!==0?t.jsxs(c.Fragment,{children:[j,$]}):$})}),me=te(t.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),xe=te(t.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function he(e){return T("MuiStepIcon",e)}const Z=U("MuiStepIcon",["root","active","completed","error","text"]);var Y;const be=["active","className","completed","error","icon"],fe=e=>{const{classes:a,active:n,completed:s,error:l}=e;return V({root:["root",n&&"active",s&&"completed",l&&"error"],text:["text"]},he,a)},q=y(ne,{name:"MuiStepIcon",slot:"Root",overridesResolver:(e,a)=>a.root})(({theme:e})=>({display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),color:(e.vars||e).palette.text.disabled,[`&.${Z.completed}`]:{color:(e.vars||e).palette.primary.main},[`&.${Z.active}`]:{color:(e.vars||e).palette.primary.main},[`&.${Z.error}`]:{color:(e.vars||e).palette.error.main}})),Se=y("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(e,a)=>a.text})(({theme:e})=>({fill:(e.vars||e).palette.primary.contrastText,fontSize:e.typography.caption.fontSize,fontFamily:e.typography.fontFamily})),ge=c.forwardRef(function(a,n){const s=_({props:a,name:"MuiStepIcon"}),{active:l=!1,className:p,completed:b=!1,error:v=!1,icon:x}=s,f=E(s,be),d=m({},s,{active:l,completed:b,error:v}),i=fe(d);if(typeof x=="number"||typeof x=="string"){const S=W(p,i.root);return v?t.jsx(q,m({as:xe,className:S,ref:n,ownerState:d},f)):b?t.jsx(q,m({as:me,className:S,ref:n,ownerState:d},f)):t.jsxs(q,m({className:S,ref:n,ownerState:d},f,{children:[Y||(Y=t.jsx("circle",{cx:"12",cy:"12",r:"12"})),t.jsx(Se,{className:i.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:d,children:x})]}))}return x});function Ce(e){return T("MuiStepLabel",e)}const N=U("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),je=["children","className","componentsProps","error","icon","optional","slotProps","StepIconComponent","StepIconProps"],Le=e=>{const{classes:a,orientation:n,active:s,completed:l,error:p,disabled:b,alternativeLabel:v}=e;return V({root:["root",n,p&&"error",b&&"disabled",v&&"alternativeLabel"],label:["label",s&&"active",l&&"completed",p&&"error",b&&"disabled",v&&"alternativeLabel"],iconContainer:["iconContainer",s&&"active",l&&"completed",p&&"error",b&&"disabled",v&&"alternativeLabel"],labelContainer:["labelContainer",v&&"alternativeLabel"]},Ce,a)},ye=y("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation]]}})(({ownerState:e})=>m({display:"flex",alignItems:"center",[`&.${N.alternativeLabel}`]:{flexDirection:"column"},[`&.${N.disabled}`]:{cursor:"default"}},e.orientation==="vertical"&&{textAlign:"left",padding:"8px 0"})),we=y("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(e,a)=>a.label})(({theme:e})=>m({},e.typography.body2,{display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),[`&.${N.active}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${N.completed}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${N.alternativeLabel}`]:{marginTop:16},[`&.${N.error}`]:{color:(e.vars||e).palette.error.main}})),Me=y("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(e,a)=>a.iconContainer})(()=>({flexShrink:0,display:"flex",paddingRight:8,[`&.${N.alternativeLabel}`]:{paddingRight:0}})),Re=y("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(e,a)=>a.labelContainer})(({theme:e})=>({width:"100%",color:(e.vars||e).palette.text.secondary,[`&.${N.alternativeLabel}`]:{textAlign:"center"}})),oe=c.forwardRef(function(a,n){var s;const l=_({props:a,name:"MuiStepLabel"}),{children:p,className:b,componentsProps:v={},error:x=!1,icon:f,optional:d,slotProps:i={},StepIconComponent:S,StepIconProps:u}=l,h=E(l,je),{alternativeLabel:j,orientation:w}=c.useContext(H),{active:I,disabled:M,completed:o,icon:r}=c.useContext(K),g=f||r;let R=S;g&&!R&&(R=ge);const L=m({},l,{active:I,alternativeLabel:j,completed:o,disabled:M,error:x,orientation:w}),z=Le(L),$=(s=i.label)!=null?s:v.label;return t.jsxs(ye,m({className:W(z.root,b),ref:n,ownerState:L},h,{children:[g||R?t.jsx(Me,{className:z.iconContainer,ownerState:L,children:t.jsx(R,m({completed:o,active:I,error:x,icon:g},u))}):null,t.jsxs(Re,{className:z.labelContainer,ownerState:L,children:[p?t.jsx(we,m({ownerState:L},$,{className:W(z.label,$==null?void 0:$.className),children:p})):null,d]})]}))});oe.muiName="StepLabel";function Ie(e){return T("MuiStepConnector",e)}U("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const Ne=["className"],Pe=e=>{const{classes:a,orientation:n,alternativeLabel:s,active:l,completed:p,disabled:b}=e,v={root:["root",n,s&&"alternativeLabel",l&&"active",p&&"completed",b&&"disabled"],line:["line",`line${ae(n)}`]};return V(v,Ie,a)},ze=y("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.completed&&a.completed]}})(({ownerState:e})=>m({flex:"1 1 auto"},e.orientation==="vertical"&&{marginLeft:12},e.alternativeLabel&&{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"})),$e=y("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.line,a[`line${ae(n.orientation)}`]]}})(({ownerState:e,theme:a})=>{const n=a.palette.mode==="light"?a.palette.grey[400]:a.palette.grey[600];return m({display:"block",borderColor:a.vars?a.vars.palette.StepConnector.border:n},e.orientation==="horizontal"&&{borderTopStyle:"solid",borderTopWidth:1},e.orientation==="vertical"&&{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24})}),ke=c.forwardRef(function(a,n){const s=_({props:a,name:"MuiStepConnector"}),{className:l}=s,p=E(s,Ne),{alternativeLabel:b,orientation:v="horizontal"}=c.useContext(H),{active:x,disabled:f,completed:d}=c.useContext(K),i=m({},s,{alternativeLabel:b,orientation:v,active:x,completed:d,disabled:f}),S=Pe(i);return t.jsx(ze,m({className:W(S.root,l),ref:n,ownerState:i},p,{children:t.jsx($e,{className:S.line,ownerState:i})}))});function Fe(e){return T("MuiStepper",e)}U("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const We=["activeStep","alternativeLabel","children","className","component","connector","nonLinear","orientation"],Be=e=>{const{orientation:a,nonLinear:n,alternativeLabel:s,classes:l}=e;return V({root:["root",a,n&&"nonLinear",s&&"alternativeLabel"]},Fe,l)},Ae=y("div",{name:"MuiStepper",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.orientation],n.alternativeLabel&&a.alternativeLabel,n.nonLinear&&a.nonLinear]}})(({ownerState:e})=>m({display:"flex"},e.orientation==="horizontal"&&{flexDirection:"row",alignItems:"center"},e.orientation==="vertical"&&{flexDirection:"column"},e.alternativeLabel&&{alignItems:"flex-start"})),Te=t.jsx(ke,{}),Ue=c.forwardRef(function(a,n){const s=_({props:a,name:"MuiStepper"}),{activeStep:l=0,alternativeLabel:p=!1,children:b,className:v,component:x="div",connector:f=Te,nonLinear:d=!1,orientation:i="horizontal"}=s,S=E(s,We),u=m({},s,{nonLinear:d,alternativeLabel:p,orientation:i,component:x}),h=Be(u),j=c.Children.toArray(b).filter(Boolean),w=j.map((M,o)=>c.cloneElement(M,m({index:o,last:o+1===j.length},M.props))),I=c.useMemo(()=>({activeStep:l,alternativeLabel:p,connector:f,nonLinear:d,orientation:i}),[l,p,f,d,i]);return t.jsx(H.Provider,{value:I,children:t.jsx(Ae,m({as:x,ownerState:u,className:W(h.root,v),ref:n},S,{children:w}))})}),ee=["Dados","Campos e filtros","Visualização","Preview e salvar"],_e={deals:["title","owner","amount","status","stage"],leads:["fullName","source","leadScore","status"],contacts:["fullName","email","owner","lifecycleStage"],activities:["type","subject","date"],accounts:["name","industry","tier"]},qe=()=>{const e=re(),{id:a}=se(),n=!a||a==="new",[s,l]=c.useState(0),[p,b]=c.useState(!n),[v,x]=c.useState(!1),[f,d]=c.useState(null),[i,S]=c.useState(null),[u,h]=c.useState({id:"",name:"",description:"",category:"custom",dataSource:"deals",filters:{},columns:["title","owner","amount"],groupBy:"owner",aggregations:[{field:"amount",fn:"sum"}],visualization:"table",isTemplate:!1,isShared:!0,createdBy:"550e8400-e29b-41d4-a716-446655440001"});c.useEffect(()=>{if(n)return;(async()=>{try{b(!0);const r=await A.reports.getById(a);if(r.data){const{createdAt:g,updatedAt:R,...L}=r.data;h(L)}}catch(r){d(r instanceof Error?r.message:"Erro ao carregar relatório")}finally{b(!1)}})()},[a,n]);const j=c.useMemo(()=>_e[u.dataSource]||[],[u.dataSource]),w=(o,r)=>{h(g=>({...g,columns:r?[...new Set([...g.columns,o])]:g.columns.filter(R=>R!==o)}))},I=async()=>{try{if(d(null),n){const o=await A.reports.save({...u,id:void 0});if(!o.data)return;const r=await A.reports.run(o.data.id);S(r.data||null),h(g=>({...g,id:o.data.id}))}else{const o=await A.reports.run(a);S(o.data||null)}}catch(o){d(o instanceof Error?o.message:"Falha ao gerar preview")}},M=async()=>{try{x(!0),d(null);const o={...u,id:n?void 0:a};(await A.reports.save(o)).data&&e("/reports")}catch(o){d(o instanceof Error?o.message:"Falha ao salvar")}finally{x(!1)}};return p?t.jsx(D,{sx:{p:3},children:t.jsx(P,{children:"Carregando..."})}):t.jsxs(D,{sx:{p:3},children:[t.jsxs(D,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[t.jsxs(D,{children:[t.jsx(P,{variant:"h4",sx:{fontWeight:700},children:"Report Builder"}),t.jsx(P,{variant:"body2",color:"text.secondary",children:"Wizard para montar relatórios customizados com filtros e agregações."})]}),t.jsx(k,{variant:"outlined",onClick:()=>e("/reports"),children:"Voltar"})]}),t.jsx(Ue,{activeStep:s,sx:{mb:2},children:ee.map(o=>t.jsx(ve,{children:t.jsx(oe,{children:o})},o))}),f&&t.jsx(le,{severity:"error",sx:{mb:2},onClose:()=>d(null),children:f}),t.jsx(Q,{children:t.jsx(X,{children:t.jsxs(F,{spacing:2,children:[t.jsx(B,{label:"Nome do relatório",value:u.name,onChange:o=>h(r=>({...r,name:o.target.value})),fullWidth:!0}),t.jsx(B,{label:"Descrição",value:u.description||"",onChange:o=>h(r=>({...r,description:o.target.value})),fullWidth:!0}),t.jsxs(F,{direction:{xs:"column",md:"row"},spacing:2,children:[t.jsxs(G,{fullWidth:!0,children:[t.jsx(J,{children:"Categoria"}),t.jsxs(O,{value:u.category,label:"Categoria",onChange:o=>h(r=>({...r,category:o.target.value})),children:[t.jsx(C,{value:"sales",children:"Sales"}),t.jsx(C,{value:"marketing",children:"Marketing"}),t.jsx(C,{value:"abm",children:"ABM"}),t.jsx(C,{value:"custom",children:"Custom"})]})]}),t.jsxs(G,{fullWidth:!0,children:[t.jsx(J,{children:"Fonte"}),t.jsxs(O,{value:u.dataSource,label:"Fonte",onChange:o=>h(r=>({...r,dataSource:o.target.value,columns:[]})),children:[t.jsx(C,{value:"deals",children:"Deals"}),t.jsx(C,{value:"leads",children:"Leads"}),t.jsx(C,{value:"contacts",children:"Contacts"}),t.jsx(C,{value:"activities",children:"Activities"}),t.jsx(C,{value:"accounts",children:"Accounts"})]})]}),t.jsxs(G,{fullWidth:!0,children:[t.jsx(J,{children:"Visualização"}),t.jsxs(O,{value:u.visualization,label:"Visualização",onChange:o=>h(r=>({...r,visualization:o.target.value})),children:[t.jsx(C,{value:"table",children:"Table"}),t.jsx(C,{value:"bar",children:"Bar"}),t.jsx(C,{value:"line",children:"Line"}),t.jsx(C,{value:"pie",children:"Pie"}),t.jsx(C,{value:"funnel",children:"Funnel"}),t.jsx(C,{value:"both",children:"Both"})]})]})]}),t.jsx(P,{variant:"subtitle2",children:"Campos"}),t.jsx(F,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:j.map(o=>t.jsx(k,{variant:u.columns.includes(o)?"contained":"outlined",size:"small",onClick:()=>w(o,!u.columns.includes(o)),children:o},o))}),t.jsxs(F,{direction:{xs:"column",md:"row"},spacing:2,children:[t.jsx(B,{label:"Filtro data (de)",type:"date",value:u.filters.dateFrom||"",onChange:o=>h(r=>({...r,filters:{...r.filters,dateFrom:o.target.value||void 0}})),InputLabelProps:{shrink:!0},fullWidth:!0}),t.jsx(B,{label:"Filtro data (até)",type:"date",value:u.filters.dateTo||"",onChange:o=>h(r=>({...r,filters:{...r.filters,dateTo:o.target.value||void 0}})),InputLabelProps:{shrink:!0},fullWidth:!0}),t.jsx(B,{label:"Agrupar por",value:u.groupBy||"",onChange:o=>h(r=>({...r,groupBy:o.target.value||void 0})),fullWidth:!0})]}),t.jsxs(F,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(P,{variant:"body2",children:"Compartilhar com time"}),t.jsx(ie,{checked:!!u.isShared,onChange:o=>h(r=>({...r,isShared:o.target.checked}))})]}),t.jsxs(F,{direction:"row",spacing:1,children:[t.jsx(k,{variant:"outlined",onClick:()=>l(o=>Math.max(0,o-1)),children:"Voltar etapa"}),t.jsx(k,{variant:"outlined",onClick:()=>l(o=>Math.min(ee.length-1,o+1)),children:"Próxima etapa"}),t.jsx(k,{variant:"contained",onClick:I,children:"Rodar preview"}),t.jsx(k,{variant:"contained",color:"success",onClick:M,disabled:v||!u.name.trim(),children:v?"Salvando...":"Salvar relatório"})]})]})})}),i&&t.jsx(Q,{sx:{mt:2},children:t.jsxs(X,{children:[t.jsxs(P,{variant:"h6",sx:{mb:1},children:["Preview (",i.rows.length," linhas)"]}),t.jsx(P,{variant:"caption",component:"pre",sx:{whiteSpace:"pre-wrap"},children:JSON.stringify(i.rows.slice(0,10),null,2)})]})})]})};export{qe as default};
