import{x as D,j as e,r as c,B as y,T as A,V as I,W as f,C as z,P as B,b as u,m as x}from"./index-D1WZwRG5.js";import{S as p}from"./Stack-BDxuP9_X.js";import{R as P}from"./Refresh-DrNglfqJ.js";import{T as R,a as G,b as L,c as C,d as t,e as W}from"./TableRow-CbZqZsXt.js";import{C as K}from"./Chip-BcfuiGLT.js";import{B as m}from"./Button-BhZ-lD3l.js";import{L as E}from"./Link-ClnrzYrs.js";import{D as H,a as M,b as O,c as F}from"./DialogTitle-CaeVllRe.js";import{S as V}from"./Snackbar-8yKmYgF-.js";import{A as q}from"./Alert-C2uN4Clt.js";const J=D(e.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),te=()=>{const[g,j]=c.useState(!0),[b,S]=c.useState([]),[v,l]=c.useState(!1),[a,i]=c.useState({connector:"stripe",apiKey:null,secret:null,webhookSecret:null,environment:"sandbox",rotateKeys:!1}),[o,n]=c.useState({open:!1,message:"",severity:"success"}),d=async()=>{j(!0);try{const s=await x.paymentGateways.listConnectors();S(s.data||[])}catch(s){n({open:!0,message:s.message||"Erro ao carregar conectores",severity:"error"})}finally{j(!1)}};c.useEffect(()=>{d()},[]);const k=s=>{i(r=>({...r,connector:s.connector})),l(!0)},w=async()=>{var s,r;try{await x.paymentGateways.saveCredentials(a);const h=await x.paymentGateways.testConnection(a.connector);n({open:!0,message:((s=h.data)==null?void 0:s.message)||"Credenciais salvas",severity:(r=h.data)!=null&&r.ok?"success":"error"}),l(!1),d()}catch(h){n({open:!0,message:h.message,severity:"error"})}},T=async s=>{try{await x.paymentGateways.toggleConnector(s),n({open:!0,message:"Status do conector atualizado",severity:"success"}),d()}catch(r){n({open:!0,message:r.message,severity:"error"})}};return e.jsxs(y,{sx:{p:3},children:[e.jsxs(p,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[e.jsx(A,{variant:"h4",fontWeight:700,children:"Gateways de Pagamento"}),e.jsx(I,{title:"Recarregar",children:e.jsx(f,{onClick:d,disabled:g,children:e.jsx(P,{})})})]}),g?e.jsx(y,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(z,{})}):e.jsx(R,{component:B,children:e.jsxs(G,{children:[e.jsx(L,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Conector"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Último sync"}),e.jsx(t,{children:"Detalhes"}),e.jsx(t,{align:"center",children:"Ações"})]})}),e.jsx(W,{children:b.map(s=>e.jsxs(C,{hover:!0,children:[e.jsx(t,{sx:{fontWeight:600},children:s.label}),e.jsx(t,{children:e.jsx(K,{size:"small",label:s.status,color:s.status==="connected"?"success":s.status==="error"?"error":"default"})}),e.jsx(t,{children:s.lastSyncAt?new Date(s.lastSyncAt).toLocaleString("pt-BR"):"-"}),e.jsx(t,{children:s.details||"-"}),e.jsx(t,{align:"center",children:e.jsxs(p,{direction:"row",spacing:.5,justifyContent:"center",children:[e.jsx(f,{size:"small",onClick:()=>k(s),children:e.jsx(J,{fontSize:"small"})}),e.jsx(m,{size:"small",variant:"outlined",onClick:()=>T(s.connector),children:s.status==="connected"?"Desconectar":"Conectar"}),e.jsx(m,{size:"small",startIcon:e.jsx(E,{}),onClick:()=>window.location.href="/billing/payment-links",children:"Links"})]})})]},s.connector))})]})}),e.jsxs(H,{open:v,onClose:()=>l(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(M,{children:"Configurar conector"}),e.jsx(O,{children:e.jsxs(p,{spacing:2,sx:{mt:1},children:[e.jsx(u,{label:"API Key",value:a.apiKey||"",onChange:s=>i({...a,apiKey:s.target.value||null})}),e.jsx(u,{label:"Secret",value:a.secret||"",onChange:s=>i({...a,secret:s.target.value||null})}),e.jsx(u,{label:"Webhook Secret",value:a.webhookSecret||"",onChange:s=>i({...a,webhookSecret:s.target.value||null})})]})}),e.jsxs(F,{children:[e.jsx(m,{onClick:()=>l(!1),children:"Cancelar"}),e.jsx(m,{variant:"contained",onClick:w,children:"Salvar e testar"})]})]}),e.jsx(V,{open:o.open,autoHideDuration:4e3,onClose:()=>n({...o,open:!1}),children:e.jsx(q,{severity:o.severity,variant:"filled",onClose:()=>n({...o,open:!1}),children:o.message})})]})};export{te as default};
