import{r as l,j as t,T as S,b as m,B as E,F as f,I as g,S as C,m as D}from"./index-D1WZwRG5.js";import{D as A,a as L,b as M,c as N}from"./DialogTitle-CaeVllRe.js";import{S as P}from"./Stack-BDxuP9_X.js";import{M as x}from"./MenuItem-C9hTkJKZ.js";import{B as T}from"./Button-BhZ-lD3l.js";const H=({open:c,mode:d="create",initialData:o,onClose:p,onSubmit:W,pipelineId:i,stages:n})=>{var y;const[w,F]=l.useState([]),[k,I]=l.useState([]),[h,j]=l.useState(!1),[v,u]=l.useState(null),[r,s]=l.useState({title:"",description:"",amount:0,expectedCloseDate:"",pipelineId:i,stageId:((y=n[0])==null?void 0:y.id)||"",accountId:"",primaryContactId:""}),b=()=>{var e;s(d==="edit"&&o?{title:o.title,description:o.description,amount:o.amount,expectedCloseDate:o.expectedCloseDate,pipelineId:o.pipelineId,stageId:o.stageId,accountId:o.accountId,primaryContactId:o.primaryContactId,ownerId:o.ownerId}:{title:"",description:"",amount:0,expectedCloseDate:"",pipelineId:i,stageId:((e=n[0])==null?void 0:e.id)||"",accountId:"",primaryContactId:""})};l.useEffect(()=>{c&&b()},[c,d,o,i,n]),l.useEffect(()=>{if(!c)return;(async()=>{const a=await D.accounts.list();F(a.data||[])})()},[c]),l.useEffect(()=>{s(e=>{var a;return{...e,pipelineId:i,stageId:e.stageId||((a=n[0])==null?void 0:a.id)||""}})},[i,n]),l.useEffect(()=>{if(!r.accountId){I([]);return}(async()=>{const a=await D.contacts.listByAccount(r.accountId);I(a.data||[])})()},[r.accountId]);const B=l.useMemo(()=>{var e;return((e=n.find(a=>a.id===r.stageId))==null?void 0:e.name)||"‚Äî"},[r.stageId,n]),R=async()=>{if(!r.title.trim()){u("T√≠tulo √© obrigat√≥rio.");return}if(!r.accountId){u("Selecione uma conta.");return}if(!r.stageId){u("Selecione um est√°gio.");return}try{j(!0),u(null),await W(r),p(),b()}catch(e){u(e instanceof Error?e.message:d==="create"?"Erro ao criar deal":"Erro ao atualizar deal")}finally{j(!1)}};return t.jsxs(A,{open:c,onClose:p,fullWidth:!0,maxWidth:"md",children:[t.jsx(L,{children:d==="create"?"üíº Novo Deal":"‚úèÔ∏è Editar Deal"}),t.jsx(M,{children:t.jsxs(P,{spacing:2,sx:{mt:1},children:[v&&t.jsx(S,{variant:"body2",color:"error",children:v}),t.jsx(m,{label:"T√≠tulo *",fullWidth:!0,value:r.title,onChange:e=>s(a=>({...a,title:e.target.value}))}),t.jsx(m,{label:"Descri√ß√£o",multiline:!0,minRows:2,fullWidth:!0,value:r.description,onChange:e=>s(a=>({...a,description:e.target.value}))}),t.jsxs(E,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[t.jsx(m,{label:"Valor (R$)",type:"number",value:r.amount,onChange:e=>s(a=>({...a,amount:Number(e.target.value)}))}),t.jsx(m,{label:"Previs√£o de fechamento",type:"date",value:r.expectedCloseDate||"",onChange:e=>s(a=>({...a,expectedCloseDate:e.target.value})),InputLabelProps:{shrink:!0}})]}),t.jsxs(E,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[t.jsxs(f,{fullWidth:!0,children:[t.jsx(g,{children:"Conta *"}),t.jsx(C,{label:"Conta *",value:r.accountId,onChange:e=>s(a=>({...a,accountId:e.target.value,primaryContactId:""})),children:w.map(e=>t.jsx(x,{value:e.id,children:e.name},e.id))})]}),t.jsxs(f,{fullWidth:!0,disabled:!r.accountId,children:[t.jsx(g,{children:"Contato principal"}),t.jsxs(C,{label:"Contato principal",value:r.primaryContactId||"",onChange:e=>s(a=>({...a,primaryContactId:e.target.value})),children:[t.jsx(x,{value:"",children:"Sem contato"}),k.map(e=>t.jsx(x,{value:e.id,children:e.fullName},e.id))]})]})]}),t.jsxs(f,{fullWidth:!0,children:[t.jsx(g,{children:"Est√°gio *"}),t.jsx(C,{label:"Est√°gio *",value:r.stageId,onChange:e=>s(a=>({...a,stageId:e.target.value})),children:n.map(e=>t.jsxs(x,{value:e.id,children:[e.name," (",e.probability,"%)"]},e.id))})]}),t.jsxs(S,{variant:"caption",color:"text.secondary",children:["Pipeline: padr√£o ‚Ä¢ Est√°gio selecionado: ",B]})]})}),t.jsxs(N,{sx:{px:3,pb:2},children:[t.jsx(T,{onClick:p,disabled:h,children:"Cancelar"}),t.jsx(T,{onClick:R,variant:"contained",disabled:h,children:h?"Salvando...":d==="create"?"Criar Deal":"Salvar altera√ß√µes"})]})]})};export{H as D};
