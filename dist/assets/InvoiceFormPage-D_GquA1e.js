import{r as d,g as G,d as E,e as L,_ as O,K as Y,f as S,j as e,i as $,l as V,s as W,P as B,ad as ee,Z as te,u as se,B as _,T as P,C as H,b as x,W as re,D as ne,m as F}from"./index-D1WZwRG5.js";import{B as N}from"./Button-BhZ-lD3l.js";import{A as oe}from"./ArrowBack-ChqsaD63.js";import{S as R}from"./Stack-BDxuP9_X.js";import{G as c}from"./Grid-DMeR_RpR.js";import{M}from"./MenuItem-C9hTkJKZ.js";import{A as ae}from"./Add-CgRR7ozh.js";import{D as ie}from"./Delete-Bp94XDaL.js";import{u as le,A as ce}from"./Alert-C2uN4Clt.js";import{C as de}from"./Collapse-DssIX4hg.js";import{E as ue}from"./ExpandMore-G5mcugwg.js";import{F as pe}from"./FormControlLabel-CTGze361.js";import{C as me}from"./Checkbox-CkPVwaBf.js";import{S as xe}from"./Snackbar-8yKmYgF-.js";import"./SwitchBase-TQvPBqmb.js";const z=d.createContext({});function he(t){return G("MuiAccordion",t)}const T=E("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),ge=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],fe=t=>{const{classes:r,square:a,expanded:l,disabled:u,disableGutters:h}=t;return V({root:["root",!a&&"rounded",l&&"expanded",u&&"disabled",!h&&"gutters"],region:["region"]},he,r)},be=W(B,{name:"MuiAccordion",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:a}=t;return[{[`& .${T.region}`]:r.region},r.root,!a.square&&r.rounded,!a.disableGutters&&r.gutters]}})(({theme:t})=>{const r={duration:t.transitions.duration.shortest};return{position:"relative",transition:t.transitions.create(["margin"],r),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(t.vars||t).palette.divider,transition:t.transitions.create(["opacity","background-color"],r)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${T.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${T.disabled}`]:{backgroundColor:(t.vars||t).palette.action.disabledBackground}}},({theme:t})=>({variants:[{props:r=>!r.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(t.vars||t).shape.borderRadius,borderBottomRightRadius:(t.vars||t).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:r=>!r.disableGutters,style:{[`&.${T.expanded}`]:{margin:"16px 0"}}}]})),ve=d.forwardRef(function(r,a){const l=L({props:r,name:"MuiAccordion"}),{children:u,className:h,defaultExpanded:v=!1,disabled:C=!1,disableGutters:n=!1,expanded:g,onChange:o,square:f=!1,slots:y={},slotProps:p={},TransitionComponent:k,TransitionProps:I}=l,j=O(l,ge),[m,q]=Y({controlled:g,default:v,name:"Accordion",state:"expanded"}),w=d.useCallback(X=>{q(!m),o&&o(X,!m)},[m,o,q]),[s,...i]=d.Children.toArray(u),b=d.useMemo(()=>({expanded:m,disabled:C,disableGutters:n,toggle:w}),[m,C,n,w]),A=S({},l,{square:f,disabled:C,disableGutters:n,expanded:m}),U=fe(A),K=S({transition:k},y),Q=S({transition:I},p),[Z,J]=le("transition",{elementType:de,externalForwardedProps:{slots:K,slotProps:Q},ownerState:A});return e.jsxs(be,S({className:$(U.root,h),ref:a,ownerState:A,square:f},j,{children:[e.jsx(z.Provider,{value:b,children:s}),e.jsx(Z,S({in:m,timeout:"auto"},J,{children:e.jsx("div",{"aria-labelledby":s.props.id,id:s.props["aria-controls"],role:"region",className:U.region,children:i})}))]}))});function ye(t){return G("MuiAccordionDetails",t)}E("MuiAccordionDetails",["root"]);const je=["className"],Ce=t=>{const{classes:r}=t;return V({root:["root"]},ye,r)},Ie=W("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(t,r)=>r.root})(({theme:t})=>({padding:t.spacing(1,2,2)})),Se=d.forwardRef(function(r,a){const l=L({props:r,name:"MuiAccordionDetails"}),{className:u}=l,h=O(l,je),v=l,C=Ce(v);return e.jsx(Ie,S({className:$(C.root,u),ref:a,ownerState:v},h))});function Ae(t){return G("MuiAccordionSummary",t)}const D=E("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),Pe=["children","className","expandIcon","focusVisibleClassName","onClick"],Re=t=>{const{classes:r,expanded:a,disabled:l,disableGutters:u}=t;return V({root:["root",a&&"expanded",l&&"disabled",!u&&"gutters"],focusVisible:["focusVisible"],content:["content",a&&"expanded",!u&&"contentGutters"],expandIconWrapper:["expandIconWrapper",a&&"expanded"]},Ae,r)},De=W(ee,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(t,r)=>r.root})(({theme:t})=>{const r={duration:t.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:t.spacing(0,2),transition:t.transitions.create(["min-height","background-color"],r),[`&.${D.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${D.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`&:hover:not(.${D.disabled})`]:{cursor:"pointer"},variants:[{props:a=>!a.disableGutters,style:{[`&.${D.expanded}`]:{minHeight:64}}}]}}),ke=W("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(t,r)=>r.content})(({theme:t})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:r=>!r.disableGutters,style:{transition:t.transitions.create(["margin"],{duration:t.transitions.duration.shortest}),[`&.${D.expanded}`]:{margin:"20px 0"}}}]})),we=W("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(t,r)=>r.expandIconWrapper})(({theme:t})=>({display:"flex",color:(t.vars||t).palette.action.active,transform:"rotate(0deg)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),[`&.${D.expanded}`]:{transform:"rotate(180deg)"}})),We=d.forwardRef(function(r,a){const l=L({props:r,name:"MuiAccordionSummary"}),{children:u,className:h,expandIcon:v,focusVisibleClassName:C,onClick:n}=l,g=O(l,Pe),{disabled:o=!1,disableGutters:f,expanded:y,toggle:p}=d.useContext(z),k=m=>{p&&p(m),n&&n(m)},I=S({},l,{expanded:y,disabled:o,disableGutters:f}),j=Re(I);return e.jsxs(De,S({focusRipple:!1,disableRipple:!0,disabled:o,component:"div","aria-expanded":y,className:$(j.root,h),focusVisibleClassName:$(j.focusVisible,C),onClick:k,ref:a,ownerState:I},g,{children:[e.jsx(ke,{className:j.content,ownerState:I,children:u}),v&&e.jsx(we,{className:j.expandIconWrapper,ownerState:I,children:v})]}))}),ze=()=>{const{id:t}=te(),r=se(),[a,l]=d.useState(!1),[u,h]=d.useState(!1),[v,C]=d.useState([]),[n,g]=d.useState({accountId:"",contactId:null,issueDate:new Date().toISOString().slice(0,10),dueDate:new Date(Date.now()+1e3*60*60*24*10).toISOString().slice(0,10),currency:"BRL",notes:null,items:[{description:"",quantity:1,unitPrice:0}]}),[o,f]=d.useState({invoiceId:"",enabled:!1,frequency:"monthly",interval:1,dayOfMonth:1,startDate:new Date().toISOString().slice(0,10),endDate:null}),[y,p]=d.useState({open:!1,message:"",severity:"success"});d.useEffect(()=>{(async()=>{l(!0);try{const i=await F.accounts.list();C(i.data||[])}catch(i){p({open:!0,message:i.message,severity:"error"})}finally{l(!1)}})()},[]);const k=()=>{g({...n,items:[...n.items,{description:"",quantity:1,unitPrice:0}]})},I=s=>{g({...n,items:n.items.filter((i,b)=>b!==s)})},j=(s,i,b)=>{const A=[...n.items];A[s]={...A[s],[i]:b},g({...n,items:A})},m=()=>n.items.reduce((s,i)=>s+Number(i.quantity||0)*Number(i.unitPrice||0),0),q=async()=>{if(!n.accountId){p({open:!0,message:"Selecione uma empresa",severity:"error"});return}if(n.items.length===0||n.items.some(s=>!s.description||s.unitPrice<=0)){p({open:!0,message:"Preencha todos os itens corretamente",severity:"error"});return}h(!0);try{const s=await F.billingInvoices.create(n);if(s.isSuccess&&s.data&&o.enabled){const i={...o,invoiceId:s.data.id};await F.billingInvoices.saveRecurrenceRule(i)}p({open:!0,message:"Fatura criada com sucesso",severity:"success"}),setTimeout(()=>r("/billing/invoices"),1200)}catch(s){p({open:!0,message:s.message||"Erro ao criar fatura",severity:"error"})}finally{h(!1)}},w=s=>`R$ ${s.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`;return e.jsxs(_,{sx:{p:3},children:[e.jsx(N,{startIcon:e.jsx(oe,{}),onClick:()=>r("/billing/invoices"),sx:{mb:2},children:"Voltar"}),e.jsx(P,{variant:"h4",fontWeight:700,sx:{mb:3},children:t?"Editar Fatura":"Nova Fatura"}),a?e.jsx(_,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(H,{})}):e.jsxs(R,{spacing:3,children:[e.jsxs(B,{sx:{p:3},children:[e.jsx(P,{variant:"h6",sx:{mb:2},children:"Informações gerais"}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(x,{select:!0,label:"Empresa",fullWidth:!0,required:!0,value:n.accountId,onChange:s=>g({...n,accountId:s.target.value}),children:v.map(s=>e.jsx(M,{value:s.id,children:s.name},s.id))})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(x,{label:"Data de emissão",type:"date",fullWidth:!0,required:!0,InputLabelProps:{shrink:!0},value:n.issueDate,onChange:s=>g({...n,issueDate:s.target.value})})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(x,{label:"Data de vencimento",type:"date",fullWidth:!0,required:!0,InputLabelProps:{shrink:!0},value:n.dueDate,onChange:s=>g({...n,dueDate:s.target.value})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(x,{label:"Observações",fullWidth:!0,multiline:!0,rows:2,value:n.notes||"",onChange:s=>g({...n,notes:s.target.value||null})})})]})]}),e.jsxs(B,{sx:{p:3},children:[e.jsxs(R,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsx(P,{variant:"h6",children:"Itens da fatura"}),e.jsx(N,{startIcon:e.jsx(ae,{}),onClick:k,children:"Adicionar Item"})]}),e.jsx(R,{spacing:2,children:n.items.map((s,i)=>e.jsx(B,{variant:"outlined",sx:{p:2},children:e.jsxs(c,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(c,{item:!0,xs:12,md:5,children:e.jsx(x,{label:"Descrição",fullWidth:!0,required:!0,value:s.description,onChange:b=>j(i,"description",b.target.value)})}),e.jsx(c,{item:!0,xs:6,md:2,children:e.jsx(x,{label:"Quantidade",type:"number",fullWidth:!0,required:!0,value:s.quantity,onChange:b=>j(i,"quantity",Number(b.target.value)),InputProps:{inputProps:{min:1}}})}),e.jsx(c,{item:!0,xs:6,md:3,children:e.jsx(x,{label:"Preço unitário",type:"number",fullWidth:!0,required:!0,value:s.unitPrice,onChange:b=>j(i,"unitPrice",Number(b.target.value)),InputProps:{inputProps:{min:0,step:.01}}})}),e.jsx(c,{item:!0,xs:10,md:1,children:e.jsx(P,{variant:"body2",fontWeight:600,children:w(s.quantity*s.unitPrice)})}),e.jsx(c,{item:!0,xs:2,md:1,children:e.jsx(re,{color:"error",onClick:()=>I(i),disabled:n.items.length===1,children:e.jsx(ie,{})})})]})},i))}),e.jsx(ne,{sx:{my:2}}),e.jsxs(R,{direction:"row",justifyContent:"flex-end",spacing:2,children:[e.jsx(P,{variant:"h6",children:"Total:"}),e.jsx(P,{variant:"h6",fontWeight:700,color:"primary.main",children:w(m())})]})]}),e.jsxs(ve,{children:[e.jsx(We,{expandIcon:e.jsx(ue,{}),children:e.jsx(P,{variant:"h6",children:"Configurar Recorrência (Opcional)"})}),e.jsx(Se,{children:e.jsxs(R,{spacing:2,children:[e.jsx(pe,{control:e.jsx(me,{checked:o.enabled,onChange:s=>f({...o,enabled:s.target.checked})}),label:"Ativar faturamento recorrente"}),o.enabled&&e.jsx(e.Fragment,{children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,md:4,children:e.jsxs(x,{select:!0,label:"Frequência",fullWidth:!0,value:o.frequency,onChange:s=>f({...o,frequency:s.target.value}),children:[e.jsx(M,{value:"monthly",children:"Mensal"}),e.jsx(M,{value:"quarterly",children:"Trimestral"}),e.jsx(M,{value:"yearly",children:"Anual"})]})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(x,{label:"Intervalo",type:"number",fullWidth:!0,value:o.interval,onChange:s=>f({...o,interval:Number(s.target.value)}),InputProps:{inputProps:{min:1}},helperText:"A cada quantos períodos"})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(x,{label:"Dia do mês",type:"number",fullWidth:!0,value:o.dayOfMonth,onChange:s=>f({...o,dayOfMonth:Number(s.target.value)}),InputProps:{inputProps:{min:1,max:28}}})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(x,{label:"Início",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:o.startDate,onChange:s=>f({...o,startDate:s.target.value})})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(x,{label:"Fim (opcional)",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:o.endDate||"",onChange:s=>f({...o,endDate:s.target.value||null})})})]})})]})})]}),e.jsxs(R,{direction:"row",justifyContent:"flex-end",spacing:2,children:[e.jsx(N,{onClick:()=>r("/billing/invoices"),disabled:u,children:"Cancelar"}),e.jsx(N,{variant:"contained",onClick:q,disabled:u,children:u?e.jsx(H,{size:20}):"Salvar Fatura"})]})]}),e.jsx(xe,{open:y.open,autoHideDuration:4e3,onClose:()=>p({...y,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ce,{severity:y.severity,variant:"filled",onClose:()=>p({...y,open:!1}),children:y.message})})]})};export{ze as default};
