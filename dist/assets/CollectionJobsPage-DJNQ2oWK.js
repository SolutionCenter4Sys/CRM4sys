import{r as n,j as e,B as h,T as a,V as I,W as v,P as u,b as R,C as k,a2 as w,m as A}from"./index-D1WZwRG5.js";import{S as p}from"./Stack-BDxuP9_X.js";import{R as B}from"./Refresh-DrNglfqJ.js";import{M as i}from"./MenuItem-C9hTkJKZ.js";import{T as J,a as P,b as W,c,d as r,e as z}from"./TableRow-CbZqZsXt.js";import{C as y}from"./Chip-BcfuiGLT.js";import{E as F}from"./ExpandMore-G5mcugwg.js";import{C as D}from"./Collapse-DssIX4hg.js";import{S as M}from"./Snackbar-8yKmYgF-.js";import{A as L}from"./Alert-C2uN4Clt.js";const Y=()=>{const[g,m]=n.useState(!0),[j,C]=n.useState([]),[l,S]=n.useState({status:"all"}),[d,b]=n.useState(null),[t,x]=n.useState({open:!1,message:"",severity:"success"}),f=async()=>{m(!0);try{const s=await A.collections.listJobs(l);C(s.data||[])}catch(s){x({open:!0,message:s.message||"Erro ao carregar jobs",severity:"error"})}finally{m(!1)}};n.useEffect(()=>{f()},[l]);const T={queued:"default",processing:"info",done:"success",error:"error"};return e.jsxs(h,{sx:{p:3},children:[e.jsxs(p,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[e.jsx(a,{variant:"h4",fontWeight:700,children:"Execuções de Régua"}),e.jsx(I,{title:"Recarregar",children:e.jsx(v,{onClick:f,disabled:g,children:e.jsx(B,{})})})]}),e.jsx(u,{sx:{p:2,mb:2},children:e.jsx(p,{direction:"row",spacing:2,flexWrap:"wrap",children:e.jsxs(R,{select:!0,label:"Status",size:"small",sx:{minWidth:160},value:l.status||"all",onChange:s=>S({...l,status:s.target.value}),children:[e.jsx(i,{value:"all",children:"Todos"}),e.jsx(i,{value:"queued",children:"Aguardando"}),e.jsx(i,{value:"processing",children:"Processando"}),e.jsx(i,{value:"done",children:"Concluído"}),e.jsx(i,{value:"error",children:"Erro"})]})})}),g?e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(k,{})}):e.jsx(J,{component:u,children:e.jsxs(P,{children:[e.jsx(W,{children:e.jsxs(c,{children:[e.jsx(r,{children:"Régua"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Início"}),e.jsx(r,{children:"Fim"}),e.jsx(r,{align:"right",children:"Total"}),e.jsx(r,{align:"right",children:"Processadas"}),e.jsx(r,{align:"right",children:"Enviadas"}),e.jsx(r,{align:"right",children:"Erros"}),e.jsx(r,{align:"center",children:"Detalhes"})]})}),e.jsx(z,{children:j.length===0?e.jsx(c,{children:e.jsx(r,{colSpan:9,align:"center",children:e.jsx(a,{variant:"body2",color:"text.secondary",sx:{py:3},children:"Nenhuma execução encontrada"})})}):j.map(s=>e.jsxs(w.Fragment,{children:[e.jsxs(c,{hover:!0,children:[e.jsx(r,{children:s.ruleName}),e.jsx(r,{children:e.jsx(y,{label:s.status,color:T[s.status],size:"small"})}),e.jsx(r,{children:new Date(s.startedAt).toLocaleString("pt-BR")}),e.jsx(r,{children:s.finishedAt?new Date(s.finishedAt).toLocaleString("pt-BR"):"-"}),e.jsx(r,{align:"right",children:s.totalInvoices}),e.jsx(r,{align:"right",children:s.processedInvoices}),e.jsx(r,{align:"right",children:s.sentCount}),e.jsx(r,{align:"right",children:e.jsx(y,{label:s.errorCount,color:s.errorCount>0?"error":"default",size:"small"})}),e.jsx(r,{align:"center",children:e.jsx(v,{size:"small",onClick:()=>b(d===s.id?null:s.id),children:e.jsx(F,{sx:{transform:d===s.id?"rotate(180deg)":"rotate(0deg)",transition:"0.2s"}})})})]}),e.jsx(c,{children:e.jsx(r,{colSpan:9,sx:{py:0},children:e.jsx(D,{in:d===s.id,children:e.jsxs(h,{sx:{p:2,bgcolor:"grey.50"},children:[e.jsxs(a,{variant:"body2",fontWeight:600,sx:{mb:1},children:["Erros (",s.errorCount,")"]}),s.errors&&s.errors.length>0?e.jsx(p,{spacing:1,children:s.errors.map((o,E)=>e.jsxs(u,{variant:"outlined",sx:{p:1},children:[e.jsx(a,{variant:"caption",color:"error.main",fontWeight:600,children:o.code}),e.jsx(a,{variant:"caption",display:"block",children:o.message}),o.invoiceId&&e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Fatura: ",o.invoiceId]})]},E))}):e.jsx(a,{variant:"caption",color:"text.secondary",children:"Nenhum erro registrado"})]})})})})]},s.id))})]})}),e.jsx(M,{open:t.open,autoHideDuration:4e3,onClose:()=>x({...t,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(L,{severity:t.severity,variant:"filled",onClose:()=>x({...t,open:!1}),children:t.message})})]})};export{Y as default};
