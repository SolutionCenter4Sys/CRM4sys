import{x as k,j as e,u as F,r as l,B as y,T as o,V as d,W as u,P as C,b as j,F as P,I as w,S as E,C as R,m as S}from"./index-D1WZwRG5.js";import{S as h}from"./Stack-BDxuP9_X.js";import{R as W}from"./Refresh-DrNglfqJ.js";import{B}from"./Button-BhZ-lD3l.js";import{A as L}from"./Add-CgRR7ozh.js";import{M as t}from"./MenuItem-C9hTkJKZ.js";import{T as N,a as V,b as A,c as p,d as s,e as D}from"./TableRow-CbZqZsXt.js";import{C as M}from"./Chip-BcfuiGLT.js";import{V as O}from"./Visibility-C5H_TSHc.js";import{P as $}from"./Payment-K_mflVr5.js";import{S as H}from"./Snackbar-8yKmYgF-.js";import{A as U}from"./Alert-C2uN4Clt.js";const q=k(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),G={draft:"default",open:"info",partial:"warning",paid:"success",overdue:"error",cancelled:"default"},J={draft:"Rascunho",open:"Em aberto",partial:"Parcial",paid:"Paga",overdue:"Vencida",cancelled:"Cancelada"},ie=()=>{const m=F(),[g,f]=l.useState(!0),[b,I]=l.useState([]),[r,c]=l.useState({status:"all"}),[n,i]=l.useState({open:!1,message:"",severity:"success"}),x=async()=>{f(!0);try{const a=await S.billingInvoices.list(r,1,100);a.isSuccess&&a.data&&I(a.data.data)}catch(a){i({open:!0,message:a.message||"Erro ao carregar faturas",severity:"error"})}finally{f(!1)}};l.useEffect(()=>{x()},[r]);const T=async a=>{if(confirm("Cancelar esta fatura?"))try{await S.billingInvoices.cancel(a,"Cancelamento via UI"),i({open:!0,message:"Fatura cancelada",severity:"success"}),x()}catch(z){i({open:!0,message:z.message,severity:"error"})}},v=a=>`R$ ${a.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`;return e.jsxs(y,{sx:{p:3},children:[e.jsxs(h,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[e.jsx(o,{variant:"h4",fontWeight:700,children:"Faturas"}),e.jsxs(h,{direction:"row",spacing:1,children:[e.jsx(d,{title:"Recarregar",children:e.jsx(u,{onClick:x,disabled:g,children:e.jsx(W,{})})}),e.jsx(B,{variant:"contained",startIcon:e.jsx(L,{}),onClick:()=>m("/billing/invoices/new"),children:"Nova Fatura"})]})]}),e.jsx(C,{sx:{p:2,mb:2},children:e.jsxs(h,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsx(j,{label:"Buscar",size:"small",sx:{minWidth:240},value:r.search||"",onChange:a=>c({...r,search:a.target.value}),placeholder:"Número, empresa..."}),e.jsxs(P,{size:"small",sx:{minWidth:160},children:[e.jsx(w,{children:"Status"}),e.jsxs(E,{value:r.status||"all",label:"Status",onChange:a=>c({...r,status:a.target.value||"all"}),children:[e.jsx(t,{value:"all",children:"Todos"}),e.jsx(t,{value:"draft",children:"Rascunho"}),e.jsx(t,{value:"open",children:"Em aberto"}),e.jsx(t,{value:"partial",children:"Parcial"}),e.jsx(t,{value:"paid",children:"Paga"}),e.jsx(t,{value:"overdue",children:"Vencida"}),e.jsx(t,{value:"cancelled",children:"Cancelada"})]})]}),e.jsx(j,{label:"Emissão de",type:"date",size:"small",sx:{minWidth:160},InputLabelProps:{shrink:!0},value:r.issueFrom||"",onChange:a=>c({...r,issueFrom:a.target.value||null})}),e.jsx(j,{label:"Emissão até",type:"date",size:"small",sx:{minWidth:160},InputLabelProps:{shrink:!0},value:r.issueTo||"",onChange:a=>c({...r,issueTo:a.target.value||null})})]})}),g?e.jsx(y,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(R,{})}):e.jsx(N,{component:C,children:e.jsxs(V,{children:[e.jsx(A,{children:e.jsxs(p,{children:[e.jsx(s,{children:"Número"}),e.jsx(s,{children:"Empresa"}),e.jsx(s,{children:"Status"}),e.jsx(s,{align:"right",children:"Total"}),e.jsx(s,{align:"right",children:"Saldo"}),e.jsx(s,{children:"Emissão"}),e.jsx(s,{children:"Vencimento"}),e.jsx(s,{align:"center",children:"Ações"})]})}),e.jsx(D,{children:b.length===0?e.jsx(p,{children:e.jsx(s,{colSpan:8,align:"center",children:e.jsx(o,{variant:"body2",color:"text.secondary",sx:{py:3},children:"Nenhuma fatura encontrada"})})}):b.map(a=>e.jsxs(p,{hover:!0,children:[e.jsx(s,{children:e.jsx(o,{variant:"body2",fontWeight:600,children:a.invoiceNumber})}),e.jsx(s,{children:a.accountName}),e.jsx(s,{children:e.jsx(M,{label:J[a.status],color:G[a.status],size:"small"})}),e.jsx(s,{align:"right",children:v(a.amountTotal)}),e.jsx(s,{align:"right",children:e.jsx(o,{variant:"body2",fontWeight:a.amountOpen>0?700:400,color:a.amountOpen>0?"error.main":"text.secondary",children:v(a.amountOpen)})}),e.jsx(s,{children:a.issueDate}),e.jsx(s,{children:e.jsx(o,{variant:"body2",color:a.status==="overdue"?"error.main":"text.primary",fontWeight:a.status==="overdue"?700:400,children:a.dueDate})}),e.jsx(s,{align:"center",children:e.jsxs(h,{direction:"row",spacing:.5,justifyContent:"center",children:[e.jsx(d,{title:"Ver detalhes",children:e.jsx(u,{size:"small",onClick:()=>m(`/billing/invoices/${a.id}`),children:e.jsx(O,{fontSize:"small"})})}),a.status!=="paid"&&a.status!=="cancelled"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{title:"Registrar pagamento",children:e.jsx(u,{size:"small",color:"success",onClick:()=>m(`/billing/invoices/${a.id}?action=payment`),children:e.jsx($,{fontSize:"small"})})}),e.jsx(d,{title:"Cancelar",children:e.jsx(u,{size:"small",color:"error",onClick:()=>T(a.id),children:e.jsx(q,{fontSize:"small"})})})]})]})})]},a.id))})]})}),e.jsx(H,{open:n.open,autoHideDuration:4e3,onClose:()=>i({...n,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(U,{severity:n.severity,variant:"filled",onClose:()=>i({...n,open:!1}),children:n.message})})]})};export{ie as default};
