import{r as i,j as e,B as p,T as j,P as m,b as d,C as f,m as T}from"./index-D1WZwRG5.js";import{S as b}from"./Stack-BDxuP9_X.js";import{M as l}from"./MenuItem-C9hTkJKZ.js";import{T as S,a as C,b as A,c as u,d as a,e as z}from"./TableRow-CbZqZsXt.js";import{C as E}from"./Chip-BcfuiGLT.js";import{S as k}from"./Snackbar-8yKmYgF-.js";import{A as B}from"./Alert-C2uN4Clt.js";const H=()=>{const[y,x]=i.useState(!0),[h,v]=i.useState([]),[r,t]=i.useState({periodFrom:null,periodTo:null,userId:null,entityType:null,action:null,severity:null,query:"",page:1,pageSize:50}),[n,c]=i.useState({open:!1,message:"",severity:"success"}),g=async()=>{var s;x(!0);try{const o=await T.compliance.searchAuditEvents(r);v(((s=o.data)==null?void 0:s.data)||[])}catch(o){c({open:!0,message:o.message,severity:"error"})}finally{x(!1)}};return i.useEffect(()=>{g()},[r]),e.jsxs(p,{sx:{p:3},children:[e.jsx(j,{variant:"h4",fontWeight:700,sx:{mb:3},children:"Trilha de Auditoria"}),e.jsx(m,{sx:{p:2,mb:2},children:e.jsxs(b,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsx(d,{size:"small",label:"Busca",value:r.query,onChange:s=>t({...r,query:s.target.value})}),e.jsxs(d,{size:"small",select:!0,label:"Entidade",sx:{minWidth:160},value:r.entityType||"",onChange:s=>t({...r,entityType:s.target.value||null}),children:[e.jsx(l,{value:"",children:"Todas"}),e.jsx(l,{value:"invoice",children:"invoice"}),e.jsx(l,{value:"payment",children:"payment"}),e.jsx(l,{value:"collection_rule",children:"collection_rule"}),e.jsx(l,{value:"template",children:"template"}),e.jsx(l,{value:"connector",children:"connector"}),e.jsx(l,{value:"permission",children:"permission"})]}),e.jsxs(d,{size:"small",select:!0,label:"Severidade",sx:{minWidth:160},value:r.severity||"",onChange:s=>t({...r,severity:s.target.value||null}),children:[e.jsx(l,{value:"",children:"Todas"}),e.jsx(l,{value:"info",children:"info"}),e.jsx(l,{value:"warning",children:"warning"}),e.jsx(l,{value:"critical",children:"critical"})]})]})}),y?e.jsx(p,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(f,{})}):e.jsx(S,{component:m,children:e.jsxs(C,{size:"small",children:[e.jsx(A,{children:e.jsxs(u,{children:[e.jsx(a,{children:"Data/Hora"}),e.jsx(a,{children:"Entidade"}),e.jsx(a,{children:"Ação"}),e.jsx(a,{children:"Resumo"}),e.jsx(a,{children:"Usuário"}),e.jsx(a,{children:"Severidade"})]})}),e.jsx(z,{children:h.length===0?e.jsx(u,{children:e.jsx(a,{colSpan:6,align:"center",children:e.jsx(j,{variant:"body2",color:"text.secondary",sx:{py:3},children:"Nenhum log encontrado"})})}):h.map(s=>e.jsxs(u,{children:[e.jsx(a,{children:new Date(s.occurredAt).toLocaleString("pt-BR")}),e.jsx(a,{children:s.entityType}),e.jsx(a,{children:s.action}),e.jsx(a,{children:s.summary}),e.jsx(a,{children:s.actorName}),e.jsx(a,{children:e.jsx(E,{size:"small",label:s.severity,color:s.severity==="critical"?"error":s.severity==="warning"?"warning":"default"})})]},s.auditId))})]})}),e.jsx(k,{open:n.open,autoHideDuration:3500,onClose:()=>c({...n,open:!1}),children:e.jsx(B,{severity:n.severity,variant:"filled",onClose:()=>c({...n,open:!1}),children:n.message})})]})};export{H as default};
