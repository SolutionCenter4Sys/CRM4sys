import{u as O,Z as P,r as i,j as e,B as o,C as B,T as x,P as R,b as d,F as b,I as v,S as p,m as y}from"./index-D1WZwRG5.js";import{A as g}from"./Alert-C2uN4Clt.js";import{S as u}from"./Stack-BDxuP9_X.js";import{B as z}from"./Button-BhZ-lD3l.js";import{M as C}from"./MenuItem-C9hTkJKZ.js";import{C as A}from"./Chip-BcfuiGLT.js";import{S as q}from"./Snackbar-8yKmYgF-.js";const M=[{value:"website",label:"Website"},{value:"linkedin",label:"LinkedIn"},{value:"referral",label:"Referral"},{value:"event",label:"Evento"},{value:"webinar",label:"Webinar"},{value:"content_download",label:"Content Download"},{value:"cold_outreach",label:"Cold Outreach"}],_=[{value:"new",label:"Novo"},{value:"working",label:"Trabalhando"},{value:"nurturing",label:"Nurturing"},{value:"unqualified",label:"Desqualificado"},{value:"converted",label:"Convertido"}],Q=()=>{const T=O(),{id:c}=P(),[I,w]=i.useState(!0),[S,N]=i.useState(!1),[W,m]=i.useState(null),[f,j]=i.useState({open:!1,message:"",severity:"info"}),[k,L]=i.useState([]),[h,D]=i.useState(null),[t,r]=i.useState(null),E=async()=>{if(c)try{w(!0),m(null);const[a,l]=await Promise.all([y.leads.getById(c),y.users.list()]),s=a.data;D(s),L(l.data||[]),r({firstName:s.firstName,lastName:s.lastName,email:s.email,phone:s.phone||"",company:s.company||"",jobTitle:s.jobTitle||"",source:s.source,status:s.status,ownerId:s.ownerId,lifecycle:s.lifecycle,tags:s.tags||[],customFields:s.customFields||{}})}catch(a){m(a instanceof Error?a.message:"Erro ao carregar lead")}finally{w(!1)}};i.useEffect(()=>{E()},[c]);const F=async()=>{if(!(!c||!t))try{N(!0),m(null),await y.leads.update(c,t),j({open:!0,message:"Lead atualizado com sucesso",severity:"success"}),await E()}catch(a){m(a instanceof Error?a.message:"Erro ao salvar lead")}finally{N(!1)}};if(I)return e.jsx(o,{sx:{py:8,textAlign:"center"},children:e.jsx(B,{})});if(!h||!t)return e.jsx(o,{sx:{p:3},children:e.jsx(g,{severity:"error",children:"Lead não encontrado."})});const n=h.isConverted;return e.jsxs(o,{sx:{p:3},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(o,{children:[e.jsx(x,{variant:"h4",sx:{fontWeight:700},children:h.fullName}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Detalhe e manutenção de lead"})]}),e.jsxs(u,{direction:"row",spacing:1,children:[e.jsx(z,{variant:"outlined",onClick:()=>T("/leads"),children:"Voltar"}),e.jsx(z,{variant:"contained",onClick:F,disabled:S||n,children:S?"Salvando...":"Salvar"})]})]}),W&&e.jsx(g,{severity:"error",sx:{mb:2},onClose:()=>m(null),children:W}),n&&e.jsx(g,{severity:"warning",sx:{mb:2},children:"Este lead já foi convertido e está em modo somente leitura."}),e.jsx(R,{sx:{p:2.5},children:e.jsxs(u,{spacing:2,children:[e.jsxs(u,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(d,{label:"Nome",size:"small",fullWidth:!0,disabled:n,value:t.firstName,onChange:a=>r(l=>l&&{...l,firstName:a.target.value})}),e.jsx(d,{label:"Sobrenome",size:"small",fullWidth:!0,disabled:n,value:t.lastName,onChange:a=>r(l=>l&&{...l,lastName:a.target.value})})]}),e.jsxs(u,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(d,{label:"Email",size:"small",fullWidth:!0,disabled:n,value:t.email,onChange:a=>r(l=>l&&{...l,email:a.target.value})}),e.jsx(d,{label:"Telefone",size:"small",fullWidth:!0,disabled:n,value:t.phone||"",onChange:a=>r(l=>l&&{...l,phone:a.target.value})})]}),e.jsxs(u,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(d,{label:"Empresa",size:"small",fullWidth:!0,disabled:n,value:t.company||"",onChange:a=>r(l=>l&&{...l,company:a.target.value})}),e.jsx(d,{label:"Cargo",size:"small",fullWidth:!0,disabled:n,value:t.jobTitle||"",onChange:a=>r(l=>l&&{...l,jobTitle:a.target.value})})]}),e.jsxs(u,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsxs(b,{size:"small",fullWidth:!0,children:[e.jsx(v,{children:"Source"}),e.jsx(p,{label:"Source",value:t.source,disabled:n,onChange:a=>r(l=>l&&{...l,source:a.target.value}),children:M.map(a=>e.jsx(C,{value:a.value,children:a.label},a.value))})]}),e.jsxs(b,{size:"small",fullWidth:!0,children:[e.jsx(v,{children:"Status"}),e.jsx(p,{label:"Status",value:t.status,disabled:n,onChange:a=>r(l=>l&&{...l,status:a.target.value}),children:_.map(a=>e.jsx(C,{value:a.value,children:a.label},a.value))})]}),e.jsxs(b,{size:"small",fullWidth:!0,children:[e.jsx(v,{children:"Owner"}),e.jsx(p,{label:"Owner",value:t.ownerId,disabled:n,onChange:a=>r(l=>l&&{...l,ownerId:a.target.value}),children:k.map(a=>e.jsx(C,{value:a.id,children:a.fullName},a.id))})]})]}),e.jsxs(o,{children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Tags atuais"}),e.jsx(o,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:.5},children:h.tags.length>0?h.tags.map(a=>e.jsx(A,{label:a,size:"small",variant:"outlined"},a)):e.jsx(x,{variant:"caption",children:"Sem tags"})})]})]})}),e.jsx(q,{open:f.open,autoHideDuration:2600,onClose:()=>j(a=>({...a,open:!1})),children:e.jsx(g,{severity:f.severity,onClose:()=>j(a=>({...a,open:!1})),sx:{width:"100%"},children:f.message})})]})};export{Q as default};
