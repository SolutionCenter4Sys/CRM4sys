import{u as T,r as t,j as e,B as d,T as s,C as B,P as m,D as A,m as u}from"./index-D1WZwRG5.js";import{S as i}from"./Stack-BDxuP9_X.js";import{B as l}from"./Button-BhZ-lD3l.js";import{C as x}from"./Chip-BcfuiGLT.js";import{A as F}from"./Alert-C2uN4Clt.js";import{C as j,a as g}from"./CardContent-C09eNwcx.js";const I=()=>{const n=T(),[k,y]=t.useState(!0),[v,p]=t.useState(null),[f,S]=t.useState([]),[C,E]=t.useState([]),[h,R]=t.useState(null),[a,c]=t.useState("all"),z=async()=>{try{y(!0),p(null);const[r,o]=await Promise.all([u.reports.templates(),u.reports.list()]);S(r.data||[]),E(o.data||[])}catch(r){p(r instanceof Error?r.message:"Erro ao carregar relatórios")}finally{y(!1)}};t.useEffect(()=>{z()},[]);const P=t.useMemo(()=>f.filter(r=>a==="all"||r.category===a),[f,a]),b=t.useMemo(()=>C.filter(r=>a==="all"||r.category===a),[C,a]),w=async r=>{try{const o=await u.reports.run(r);R(o.data||null)}catch(o){p(o instanceof Error?o.message:"Falha ao executar relatório")}};return e.jsxs(d,{sx:{p:3},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",mb:2,gap:2,flexWrap:"wrap"},children:[e.jsxs(d,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:700},children:"Reports & BI"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Catálogo de templates, relatórios salvos e execução sob demanda."})]}),e.jsxs(i,{direction:"row",spacing:1,children:[e.jsx(l,{variant:"outlined",onClick:()=>n("/reports/scheduled"),children:"Agendados"}),e.jsx(l,{variant:"outlined",onClick:()=>n("/exports"),children:"Exportações"}),e.jsx(l,{variant:"contained",onClick:()=>n("/reports/new"),children:"Novo relatório"})]})]}),e.jsxs(i,{direction:"row",spacing:1,sx:{mb:2},children:[e.jsx(x,{label:"Todos",color:a==="all"?"primary":"default",onClick:()=>c("all")}),e.jsx(x,{label:"Sales",color:a==="sales"?"primary":"default",onClick:()=>c("sales")}),e.jsx(x,{label:"Marketing",color:a==="marketing"?"primary":"default",onClick:()=>c("marketing")}),e.jsx(x,{label:"ABM",color:a==="abm"?"primary":"default",onClick:()=>c("abm")}),e.jsx(x,{label:"Custom",color:a==="custom"?"primary":"default",onClick:()=>c("custom")})]}),v&&e.jsx(F,{severity:"error",sx:{mb:2},onClose:()=>p(null),children:v}),k?e.jsx(d,{sx:{display:"flex",justifyContent:"center",py:7},children:e.jsx(B,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(d,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,mb:2},children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(s,{variant:"h6",sx:{mb:1.2},children:"Templates"}),e.jsx(i,{spacing:1,children:P.map(r=>e.jsxs(m,{variant:"outlined",sx:{p:1.2},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:700},children:r.name}),e.jsx(s,{variant:"caption",color:"text.secondary",children:r.description||"Template sem descrição"}),e.jsxs(i,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(l,{size:"small",variant:"outlined",onClick:()=>w(r.id),children:"Rodar"}),e.jsx(l,{size:"small",onClick:()=>n(`/reports/${r.id}`),children:"Personalizar"})]})]},r.id))})]})}),e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(s,{variant:"h6",sx:{mb:1.2},children:"Relatórios salvos"}),e.jsx(i,{spacing:1,children:b.length===0?e.jsx(s,{variant:"body2",color:"text.secondary",children:"Nenhum relatório salvo para este filtro."}):b.map(r=>e.jsxs(m,{variant:"outlined",sx:{p:1.2},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:700},children:r.name}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Fonte: ",r.dataSource," • Visualização: ",r.visualization]}),e.jsxs(i,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(l,{size:"small",variant:"outlined",onClick:()=>w(r.id),children:"Executar"}),e.jsx(l,{size:"small",onClick:()=>n(`/reports/${r.id}`),children:"Editar"})]})]},r.id))})]})})]}),e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(s,{variant:"h6",sx:{mb:1},children:"Preview de execução"}),h?e.jsxs(e.Fragment,{children:[e.jsxs(s,{variant:"caption",color:"text.secondary",children:[new Date(h.generatedAt).toLocaleString("pt-BR")," • ",h.rows.length," linhas"]}),e.jsx(A,{sx:{my:1}}),e.jsx(i,{spacing:.6,children:h.rows.slice(0,8).map((r,o)=>e.jsx(m,{variant:"outlined",sx:{p:1},children:e.jsx(s,{variant:"caption",component:"pre",sx:{m:0,whiteSpace:"pre-wrap"},children:JSON.stringify(r,null,2)})},`row-${o}`))})]}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"Execute um template ou relatório para visualizar o preview."})]})})]})]})};export{I as default};
