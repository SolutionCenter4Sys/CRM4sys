import{r,j as e,B as h,T as a,F as u,I as p,S as m,b as F,P as B,m as j}from"./index-D1WZwRG5.js";import{A as D}from"./Alert-C2uN4Clt.js";import{C as v,a as f}from"./CardContent-C09eNwcx.js";import{S as o}from"./Stack-BDxuP9_X.js";import{M as t}from"./MenuItem-C9hTkJKZ.js";import{B as g}from"./Button-BhZ-lD3l.js";import{C as A}from"./Chip-BcfuiGLT.js";const L=()=>{const[l,n]=r.useState(null),[y,C]=r.useState([]),[i,E]=r.useState("deals"),[c,S]=r.useState("csv"),[d,b]=r.useState(1e3),x=async()=>{try{const s=await j.exports.listJobs();C(s.data||[])}catch(s){n(s instanceof Error?s.message:"Erro ao carregar exportações")}};r.useEffect(()=>{x()},[]);const w=async()=>{try{n(null),await j.exports.requestJob({entity:i,format:c,records:d,requestedBy:"550e8400-e29b-41d4-a716-446655440001"}),await x()}catch(s){n(s instanceof Error?s.message:"Falha ao solicitar exportação")}};return e.jsxs(h,{sx:{p:3},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:.5},children:"Data Export"}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Exportações pontuais e em lote (CSV/Excel/JSON/PDF), com histórico de jobs."}),l&&e.jsx(D,{severity:"error",sx:{mb:2},onClose:()=>n(null),children:l}),e.jsx(v,{sx:{mb:2},children:e.jsxs(f,{children:[e.jsx(a,{variant:"h6",sx:{mb:1},children:"Solicitar exportação"}),e.jsxs(o,{direction:{xs:"column",md:"row"},spacing:1.5,children:[e.jsxs(u,{fullWidth:!0,children:[e.jsx(p,{children:"Entidade"}),e.jsxs(m,{value:i,label:"Entidade",onChange:s=>E(s.target.value),children:[e.jsx(t,{value:"contacts",children:"Contacts"}),e.jsx(t,{value:"accounts",children:"Accounts"}),e.jsx(t,{value:"deals",children:"Deals"}),e.jsx(t,{value:"leads",children:"Leads"}),e.jsx(t,{value:"reports",children:"Reports"})]})]}),e.jsxs(u,{fullWidth:!0,children:[e.jsx(p,{children:"Formato"}),e.jsxs(m,{value:c,label:"Formato",onChange:s=>S(s.target.value),children:[e.jsx(t,{value:"csv",children:"CSV"}),e.jsx(t,{value:"excel",children:"Excel"}),e.jsx(t,{value:"json",children:"JSON"}),e.jsx(t,{value:"pdf",children:"PDF"})]})]}),e.jsx(F,{type:"number",label:"Qtd. registros",value:d,onChange:s=>b(Number(s.target.value||0)),fullWidth:!0}),e.jsx(g,{variant:"contained",onClick:w,children:"Solicitar"})]})]})}),e.jsx(v,{children:e.jsxs(f,{children:[e.jsx(a,{variant:"h6",sx:{mb:1},children:"Histórico de exportações"}),e.jsx(o,{spacing:1,children:y.map(s=>e.jsx(B,{variant:"outlined",sx:{p:1.2},children:e.jsxs(o,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:1,children:[e.jsxs(h,{children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:700},children:[s.entity," • ",s.format.toUpperCase()]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[new Date(s.requestedAt).toLocaleString("pt-BR")," • ",s.records," registros"]})]}),e.jsxs(o,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(A,{size:"small",label:s.status,color:s.status==="done"?"success":s.status==="failed"?"error":"warning"}),s.downloadUrl&&e.jsx(g,{size:"small",variant:"outlined",href:s.downloadUrl,children:"Download"})]})]})},s.id))})]})})]})};export{L as default};
