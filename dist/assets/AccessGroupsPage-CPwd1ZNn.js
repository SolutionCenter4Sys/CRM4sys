import{r,j as e,B as A,T as u,P as k,b as f,C as ee,W,m}from"./index-D1WZwRG5.js";import{S as p}from"./Stack-BDxuP9_X.js";import{B as l}from"./Button-BhZ-lD3l.js";import{M as G}from"./MenuItem-C9hTkJKZ.js";import{T as se,a as ae,b as re,c as F,d as i,e as ie}from"./TableRow-CbZqZsXt.js";import{C as B}from"./Chip-BcfuiGLT.js";import{E as te}from"./EditOutlined-CEQXckDg.js";import{D as ne}from"./DeleteOutline-CoTBT85l.js";import{D as E,a as M,b as O,c as R}from"./DialogTitle-CaeVllRe.js";import{F as oe}from"./FormControlLabel-CTGze361.js";import{S as le}from"./Switch-axFPc32Z.js";import{S as ce}from"./Snackbar-8yKmYgF-.js";import{A as de}from"./Alert-C2uN4Clt.js";import"./SwitchBase-TQvPBqmb.js";const w={id:"",name:"",description:"",isActive:!0},ke=()=>{const[N,P]=r.useState(!0),[h,H]=r.useState([]),[T,K]=r.useState([]),[y,L]=r.useState(""),[x,q]=r.useState("all"),[_,c]=r.useState(!1),[D,z]=r.useState(!1),[o,d]=r.useState(w),[g,C]=r.useState(null),[b,I]=r.useState([]),[S,n]=r.useState({open:!1,message:"",severity:"success"}),j=async()=>{var s;P(!0);try{const[a,t]=await Promise.all([m.access.listGroups({search:y||null,isActive:x==="all"?null:x==="active",page:1,pageSize:200}),m.access.listPermissionCatalog()]);H(((s=a.data)==null?void 0:s.data)||[]),K(t.data||[])}catch(a){n({open:!0,message:a.message||"Falha ao carregar grupos",severity:"error"})}finally{P(!1)}};r.useEffect(()=>{j()},[y,x]);const v=r.useMemo(()=>h.find(s=>s.id===g)||null,[h,g]),J=r.useMemo(()=>{const s=new Map;return T.forEach(a=>{s.has(a.module)||s.set(a.module,[]),s.get(a.module).push(a)}),Array.from(s.entries())},[T]),Q=()=>{d(w),c(!0)},U=s=>{d({id:s.id,name:s.name,description:s.description||"",isActive:s.isActive}),c(!0)},V=async()=>{if(!o.name.trim()){n({open:!0,message:"Informe o nome do grupo.",severity:"error"});return}z(!0);try{await m.access.saveGroup({id:o.id||void 0,name:o.name.trim(),description:o.description.trim()||null,isActive:o.isActive}),c(!1),n({open:!0,message:"Grupo salvo com sucesso.",severity:"success"}),await j()}catch(s){n({open:!0,message:s.message||"Falha ao salvar grupo",severity:"error"})}finally{z(!1)}},X=async s=>{try{await m.access.deleteGroup(s),n({open:!0,message:"Grupo removido com sucesso.",severity:"success"}),await j()}catch(a){n({open:!0,message:a.message||"Falha ao remover grupo",severity:"error"})}},Y=async s=>{C(s.id),I(s.permissionKeys)},Z=s=>{I(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},$=async()=>{if(g)try{await m.access.saveGroupPermissions(g,b),n({open:!0,message:"Permissões salvas com sucesso.",severity:"success"}),await j()}catch(s){n({open:!0,message:s.message||"Falha ao salvar permissões",severity:"error"})}};return e.jsxs(A,{sx:{p:3},children:[e.jsxs(p,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(A,{children:[e.jsx(u,{variant:"h4",fontWeight:700,children:"Gestão de Grupos de Acesso"}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Cadastre grupos, gerencie permissões e acompanhe membros vinculados."})]}),e.jsx(l,{variant:"contained",onClick:Q,children:"Novo grupo"})]}),e.jsx(k,{sx:{p:2,mb:2},children:e.jsxs(p,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(f,{fullWidth:!0,size:"small",label:"Buscar por nome/descrição",value:y,onChange:s=>L(s.target.value)}),e.jsxs(f,{select:!0,size:"small",label:"Status",value:x,onChange:s=>q(s.target.value),sx:{minWidth:180},children:[e.jsx(G,{value:"all",children:"Todos"}),e.jsx(G,{value:"active",children:"Ativos"}),e.jsx(G,{value:"inactive",children:"Inativos"})]})]})}),N?e.jsx(A,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(ee,{})}):e.jsx(se,{component:k,children:e.jsxs(ae,{size:"small",children:[e.jsx(re,{children:e.jsxs(F,{children:[e.jsx(i,{children:"Grupo"}),e.jsx(i,{children:"Descrição"}),e.jsx(i,{children:"Permissões"}),e.jsx(i,{children:"Membros"}),e.jsx(i,{children:"Status"}),e.jsx(i,{align:"right",children:"Ações"})]})}),e.jsx(ie,{children:h.length===0?e.jsx(F,{children:e.jsx(i,{colSpan:6,align:"center",children:e.jsx(u,{variant:"body2",color:"text.secondary",sx:{py:3},children:"Nenhum grupo encontrado."})})}):h.map(s=>e.jsxs(F,{hover:!0,children:[e.jsx(i,{children:e.jsx(u,{variant:"body2",fontWeight:600,children:s.name})}),e.jsx(i,{children:s.description||"-"}),e.jsx(i,{children:e.jsxs(l,{size:"small",onClick:()=>Y(s),children:[s.permissionKeys.length," permissões"]})}),e.jsx(i,{children:s.membersCount}),e.jsx(i,{children:e.jsx(B,{size:"small",label:s.isActive?"Ativo":"Inativo",color:s.isActive?"success":"default"})}),e.jsxs(i,{align:"right",children:[e.jsx(W,{size:"small",onClick:()=>U(s),children:e.jsx(te,{fontSize:"small"})}),e.jsx(W,{size:"small",color:"error",onClick:()=>X(s.id),children:e.jsx(ne,{fontSize:"small"})})]})]},s.id))})]})}),e.jsxs(E,{open:_,onClose:()=>c(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(M,{children:o.id?"Editar grupo":"Novo grupo"}),e.jsx(O,{children:e.jsxs(p,{spacing:2,sx:{mt:1},children:[e.jsx(f,{label:"Nome do grupo",value:o.name,onChange:s=>d(a=>({...a,name:s.target.value})),required:!0}),e.jsx(f,{label:"Descrição",value:o.description,multiline:!0,minRows:3,onChange:s=>d(a=>({...a,description:s.target.value}))}),e.jsx(oe,{control:e.jsx(le,{checked:o.isActive,onChange:(s,a)=>d(t=>({...t,isActive:a}))}),label:"Grupo ativo"})]})}),e.jsxs(R,{children:[e.jsx(l,{onClick:()=>c(!1),children:"Cancelar"}),e.jsx(l,{variant:"contained",onClick:V,disabled:D,children:D?"Salvando...":"Salvar"})]})]}),e.jsxs(E,{open:!!v,onClose:()=>C(null),fullWidth:!0,maxWidth:"md",children:[e.jsxs(M,{children:["Permissões do grupo ",v==null?void 0:v.name]}),e.jsx(O,{dividers:!0,children:e.jsx(p,{spacing:2,children:J.map(([s,a])=>e.jsxs(k,{variant:"outlined",sx:{p:2},children:[e.jsx(u,{variant:"subtitle2",sx:{mb:1},children:s}),e.jsx(p,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:a.map(t=>e.jsx(B,{clickable:!0,color:b.includes(t.key)?"primary":"default",label:t.label,onClick:()=>Z(t.key),variant:b.includes(t.key)?"filled":"outlined"},t.key))})]},s))})}),e.jsxs(R,{children:[e.jsx(l,{onClick:()=>C(null),children:"Fechar"}),e.jsx(l,{variant:"contained",onClick:$,children:"Salvar permissões"})]})]}),e.jsx(ce,{open:S.open,autoHideDuration:3500,onClose:()=>n(s=>({...s,open:!1})),children:e.jsx(de,{severity:S.severity,variant:"filled",onClose:()=>n(s=>({...s,open:!1})),children:S.message})})]})};export{ke as default};
