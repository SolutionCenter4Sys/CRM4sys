import{r as n,j as e,B as I,T as o,P as j,b as k,m as c}from"./index-D1WZwRG5.js";import{S as y}from"./Stack-BDxuP9_X.js";import{B as l}from"./Button-BhZ-lD3l.js";import{F as m}from"./FileDownload-xGpG_pRF.js";import{T as f,a as v,b,c as t,d as r,e as S}from"./TableRow-CbZqZsXt.js";import{C as A}from"./Chip-BcfuiGLT.js";import{R as w}from"./Refresh-DrNglfqJ.js";import{S as B}from"./Snackbar-8yKmYgF-.js";import{A as D}from"./Alert-C2uN4Clt.js";const W=()=>{const[d,C]=n.useState(""),[u,E]=n.useState([]),[g,R]=n.useState([]),[x,a]=n.useState({open:!1,message:"",severity:"success"}),h=async()=>{try{const[s,i]=await Promise.all([c.access.listAuditEvents(d),c.access.listExportHistory()]);E(s.data||[]),R(i.data||[])}catch(s){a({open:!0,message:s.message||"Falha ao carregar dados",severity:"error"})}};n.useEffect(()=>{h()},[d]);const p=async s=>{try{await c.access.requestAuditExport(s),a({open:!0,message:`Exportação ${s.toUpperCase()} gerada.`,severity:"success"}),await h()}catch(i){a({open:!0,message:i.message||"Falha ao gerar exportação",severity:"error"})}},T=async s=>{try{await c.access.regenerateExport(s),a({open:!0,message:"Exportação renovada.",severity:"success"}),await h()}catch(i){a({open:!0,message:i.message||"Falha ao renovar exportação",severity:"error"})}};return e.jsxs(I,{sx:{p:3},children:[e.jsx(o,{variant:"h4",fontWeight:700,sx:{mb:2},children:"Auditoria IAM e Relatórios"}),e.jsx(j,{sx:{p:2,mb:2},children:e.jsxs(y,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(k,{size:"small",fullWidth:!0,label:"Buscar em ator, entidade ou detalhes",value:d,onChange:s=>C(s.target.value)}),e.jsx(l,{variant:"contained",startIcon:e.jsx(m,{}),onClick:()=>p("csv"),children:"CSV"}),e.jsx(l,{variant:"outlined",startIcon:e.jsx(m,{}),onClick:()=>p("xlsx"),children:"XLSX"}),e.jsx(l,{variant:"outlined",startIcon:e.jsx(m,{}),onClick:()=>p("pdf"),children:"PDF"})]})}),e.jsxs(j,{sx:{p:2,mb:2},children:[e.jsx(o,{variant:"h6",sx:{mb:1},children:"Trilha de auditoria IAM"}),e.jsx(f,{children:e.jsxs(v,{size:"small",children:[e.jsx(b,{children:e.jsxs(t,{children:[e.jsx(r,{children:"Data/Hora"}),e.jsx(r,{children:"Ator"}),e.jsx(r,{children:"Ação"}),e.jsx(r,{children:"Entidade"}),e.jsx(r,{children:"Detalhes"}),e.jsx(r,{children:"Severidade"})]})}),e.jsx(S,{children:u.length===0?e.jsx(t,{children:e.jsx(r,{colSpan:6,align:"center",children:e.jsx(o,{variant:"body2",color:"text.secondary",sx:{py:3},children:"Nenhum evento encontrado."})})}):u.map(s=>e.jsxs(t,{children:[e.jsx(r,{children:new Date(s.timestamp).toLocaleString("pt-BR")}),e.jsx(r,{children:s.actor}),e.jsx(r,{children:s.action}),e.jsx(r,{children:s.entityName}),e.jsx(r,{children:s.details||"-"}),e.jsx(r,{children:e.jsx(A,{size:"small",label:s.severity,color:s.severity==="high"?"error":s.severity==="medium"?"warning":"default"})})]},s.eventId))})]})})]}),e.jsxs(j,{sx:{p:2},children:[e.jsx(o,{variant:"h6",sx:{mb:1},children:"Histórico de exportações"}),e.jsx(f,{children:e.jsxs(v,{size:"small",children:[e.jsx(b,{children:e.jsxs(t,{children:[e.jsx(r,{children:"Tipo"}),e.jsx(r,{children:"Formato"}),e.jsx(r,{children:"Gerado em"}),e.jsx(r,{children:"Expira em"}),e.jsx(r,{children:"Status"}),e.jsx(r,{align:"right",children:"Ações"})]})}),e.jsx(S,{children:g.length===0?e.jsx(t,{children:e.jsx(r,{colSpan:6,align:"center",children:e.jsx(o,{variant:"body2",color:"text.secondary",sx:{py:3},children:"Nenhuma exportação no histórico."})})}):g.map(s=>e.jsxs(t,{children:[e.jsx(r,{children:s.type}),e.jsx(r,{children:s.format.toUpperCase()}),e.jsx(r,{children:new Date(s.generatedAt).toLocaleString("pt-BR")}),e.jsx(r,{children:new Date(s.expiresAt).toLocaleString("pt-BR")}),e.jsx(r,{children:e.jsx(A,{size:"small",label:s.status,color:s.status==="completed"?"success":"default"})}),e.jsx(r,{align:"right",children:e.jsxs(y,{direction:"row",spacing:1,justifyContent:"flex-end",children:[s.downloadUrl&&e.jsx(l,{size:"small",href:s.downloadUrl,target:"_blank",children:"Download"}),e.jsx(l,{size:"small",startIcon:e.jsx(w,{}),onClick:()=>T(s.exportId),children:"Renovar"})]})})]},s.exportId))})]})})]}),e.jsx(B,{open:x.open,autoHideDuration:3500,onClose:()=>a(s=>({...s,open:!1})),children:e.jsx(D,{severity:x.severity,variant:"filled",onClose:()=>a(s=>({...s,open:!1})),children:x.message})})]})};export{W as default};
