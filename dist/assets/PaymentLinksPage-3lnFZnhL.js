import{x as B,j as e,r as s,B as v,T as p,C as E,P as f,b as l,W as R,m as j}from"./index-D1WZwRG5.js";import{S as b}from"./Stack-BDxuP9_X.js";import{M as A}from"./MenuItem-C9hTkJKZ.js";import{B as N}from"./Button-BhZ-lD3l.js";import{L as O}from"./Link-ClnrzYrs.js";import{S as V}from"./Snackbar-8yKmYgF-.js";import{A as D}from"./Alert-C2uN4Clt.js";const H=B(e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy"),q=()=>{const[S,d]=s.useState(!0),[x,k]=s.useState([]),[u,g]=s.useState(""),[y,m]=s.useState(0),[h,I]=s.useState(3),[a,C]=s.useState(null),[r,n]=s.useState({open:!1,message:"",severity:"success"});s.useEffect(()=>{(async()=>{var o;d(!0);try{const c=(((o=(await j.billingInvoices.list({status:"all"},1,200)).data)==null?void 0:o.data)||[]).filter(w=>w.amountOpen>0);k(c),c[0]&&(g(c[0].id),m(c[0].amountOpen))}catch(i){n({open:!0,message:i.message,severity:"error"})}finally{d(!1)}})()},[]);const L=async()=>{if(u)try{const t=await j.paymentGateways.generatePaymentLink({invoiceId:u,amount:y,currency:"BRL",expiresInDays:h,allowPartial:!1,customerEmail:null,customerName:null,description:null});C(t.data||null),n({open:!0,message:"Link gerado com sucesso",severity:"success"})}catch(t){n({open:!0,message:t.message,severity:"error"})}},P=async()=>{a!=null&&a.url&&(await navigator.clipboard.writeText(a.url),n({open:!0,message:"Link copiado",severity:"success"}))};return e.jsxs(v,{sx:{p:3},children:[e.jsx(p,{variant:"h4",fontWeight:700,sx:{mb:3},children:"Gerar Link de Pagamento"}),S?e.jsx(v,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(E,{})}):e.jsxs(f,{sx:{p:3},children:[e.jsxs(b,{spacing:2,children:[e.jsx(l,{select:!0,label:"Fatura",value:u,onChange:t=>{g(t.target.value);const o=x.find(i=>i.id===t.target.value);o&&m(o.amountOpen)},children:x.map(t=>e.jsxs(A,{value:t.id,children:[t.invoiceNumber," • ",t.accountName," • Saldo R$ ",t.amountOpen.toLocaleString("pt-BR")]},t.id))}),e.jsx(l,{label:"Valor",type:"number",value:y,onChange:t=>m(Number(t.target.value))}),e.jsx(l,{label:"Validade (dias)",type:"number",value:h,onChange:t=>I(Number(t.target.value))}),e.jsx(N,{variant:"contained",startIcon:e.jsx(O,{}),onClick:L,children:"Gerar link"})]}),a&&e.jsxs(f,{variant:"outlined",sx:{p:2,mt:2},children:[e.jsx(p,{variant:"subtitle2",children:"Link gerado"}),e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[e.jsx(l,{fullWidth:!0,value:a.url,InputProps:{readOnly:!0}}),e.jsx(R,{onClick:P,children:e.jsx(H,{})})]}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:["Expira em: ",new Date(a.expiresAt).toLocaleString("pt-BR")]})]})]}),e.jsx(V,{open:r.open,autoHideDuration:3500,onClose:()=>n({...r,open:!1}),children:e.jsx(D,{severity:r.severity,variant:"filled",onClose:()=>n({...r,open:!1}),children:r.message})})]})};export{q as default};
