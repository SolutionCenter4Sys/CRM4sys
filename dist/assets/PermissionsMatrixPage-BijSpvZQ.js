import{r as i,j as e,B as p,T as o,C as y,P as v,m as h}from"./index-D1WZwRG5.js";import{T as b,a as S,b as C,c as g,d as l,e as k}from"./TableRow-CbZqZsXt.js";import{C as P}from"./Checkbox-CkPVwaBf.js";import{S as T}from"./Stack-BDxuP9_X.js";import{B}from"./Button-BhZ-lD3l.js";import{S as w}from"./Snackbar-8yKmYgF-.js";import{A}from"./Alert-C2uN4Clt.js";import"./SwitchBase-TQvPBqmb.js";const W=()=>{const[u,c]=i.useState(!0),[a,d]=i.useState(null),[x,m]=i.useState(!1),[r,n]=i.useState({open:!1,message:"",severity:"success"});i.useEffect(()=>{(async()=>{c(!0);try{const t=await h.compliance.getRolePermissionMatrix();d(t.data||null)}catch(t){n({open:!0,message:t.message,severity:"error"})}finally{c(!1)}})()},[]);const f=(s,t)=>{a&&d({...a,grants:{...a.grants,[s]:{...a.grants[s],[t]:!a.grants[s][t]}}})},j=async()=>{if(a){m(!0);try{await h.compliance.saveRolePermissionMatrix(a),n({open:!0,message:"Permissões salvas com sucesso",severity:"success"})}catch(s){n({open:!0,message:s.message,severity:"error"})}finally{m(!1)}}};return e.jsxs(p,{sx:{p:3},children:[e.jsx(o,{variant:"h4",fontWeight:700,sx:{mb:3},children:"Matriz de Permissões Financeiras"}),u||!a?e.jsx(p,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(y,{})}):e.jsxs(v,{sx:{p:2},children:[e.jsxs(o,{variant:"caption",color:"text.secondary",children:["Última atualização: ",a.lastUpdatedAt?new Date(a.lastUpdatedAt).toLocaleString("pt-BR"):"-"," por"," ",a.lastUpdatedByName||"-"]}),e.jsx(b,{sx:{mt:2},children:e.jsxs(S,{size:"small",children:[e.jsx(C,{children:e.jsxs(g,{children:[e.jsx(l,{children:"Permissão"}),a.roles.map(s=>e.jsx(l,{align:"center",children:s.label},s.role))]})}),e.jsx(k,{children:a.permissions.map(s=>e.jsxs(g,{children:[e.jsxs(l,{children:[e.jsx(o,{variant:"body2",fontWeight:600,children:s.label}),e.jsx(o,{variant:"caption",color:"text.secondary",children:s.description})]}),a.roles.map(t=>e.jsx(l,{align:"center",children:e.jsx(P,{checked:a.grants[t.role][s.key],onChange:()=>f(t.role,s.key)})},`${s.key}-${t.role}`))]},s.key))})]})}),e.jsx(T,{direction:"row",justifyContent:"flex-end",sx:{mt:2},children:e.jsx(B,{variant:"contained",onClick:j,disabled:x,children:x?"Salvando...":"Salvar alterações"})})]}),e.jsx(w,{open:r.open,autoHideDuration:3500,onClose:()=>n({...r,open:!1}),children:e.jsx(A,{severity:r.severity,variant:"filled",onClose:()=>n({...r,open:!1}),children:r.message})})]})};export{W as default};
