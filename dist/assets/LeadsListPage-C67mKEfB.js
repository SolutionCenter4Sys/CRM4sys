import{x as K,j as s,u as ss,a as as,r as t,B as u,T as l,P as Ce,b as h,F as x,I as j,S as v,C as ts,V as ns,W as J,m as g}from"./index-D1WZwRG5.js";import{B as f}from"./Button-BhZ-lD3l.js";import{A as rs}from"./Add-CgRR7ozh.js";import{S as C}from"./Stack-BDxuP9_X.js";import{M as i}from"./MenuItem-C9hTkJKZ.js";import{S as ls,a as os}from"./TablePagination-Bzp67lwk.js";import{A as F}from"./Alert-C2uN4Clt.js";import{T as is,a as cs,b as ds,c as B,d,e as us}from"./TableRow-CbZqZsXt.js";import{C as Se}from"./Chip-BcfuiGLT.js";import{E as ms}from"./EditOutlined-CEQXckDg.js";import{D as hs}from"./DeleteOutline-CoTBT85l.js";import{D as we,a as Le,b as Ne,c as Ie}from"./DialogTitle-CaeVllRe.js";import{S as xs}from"./Snackbar-8yKmYgF-.js";import"./KeyboardArrowRight-DRYK2Ozh.js";const js=K(s.jsx("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6m6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26"}),"Autorenew"),vs=K(s.jsx("path",{d:"M22 18v-2H8V4h2L7 1 4 4h2v2H2v2h4v8c0 1.1.9 2 2 2h8v2h-2l3 3 3-3h-2v-2zM10 8h6v6h2V8c0-1.1-.9-2-2-2h-6z"}),"Transform"),ps=K(s.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4m0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7"}),"VisibilityOutlined"),ke={website:"Website",linkedin:"LinkedIn",referral:"Referral",event:"Evento",webinar:"Webinar",content_download:"Content Download",cold_outreach:"Cold Outreach"},De={new:"Novo",working:"Trabalhando",nurturing:"Nurturing",unqualified:"Desqualificado",converted:"Convertido"},ze=Object.entries(ke),Te=Object.entries(De),We=n=>{if(!n)return"agora";const N=Date.now()-new Date(n).getTime(),S=Math.max(1,Math.floor(N/(1e3*60)));if(S<60)return`${S}min atrÃ¡s`;const b=Math.floor(S/60);return b<24?`${b}h atrÃ¡s`:`${Math.floor(b/24)}d atrÃ¡s`},gs=n=>n>=70?{label:"ðŸ”¥ Hot",color:"error"}:n>=40?{label:"âš¡ Warm",color:"warning"}:{label:"â„ï¸ Cold",color:"info"},fs=({details:n,isLoading:N,onRecalculate:S,recalculating:b})=>N?s.jsx(u,{sx:{width:340,p:1.5},children:s.jsx(l,{variant:"body2",children:"Carregando breakdown..."})}):n?s.jsxs(u,{sx:{width:360,p:1.5},children:[s.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[s.jsx(l,{variant:"subtitle2",sx:{fontWeight:700},children:"Lead Score Breakdown"}),s.jsx(f,{size:"small",variant:"outlined",startIcon:s.jsx(js,{fontSize:"small"}),onClick:S,disabled:b,children:"Recalcular"})]}),s.jsxs(l,{variant:"body2",sx:{mb:1},children:["Total: ",s.jsxs("strong",{children:[n.total,"/100"]})," (",n.classification.toUpperCase(),")"]}),s.jsxs(l,{variant:"caption",sx:{fontWeight:700},children:["Demographic Fit: ",n.breakdown.demographicFit.score,"/",n.breakdown.demographicFit.maxScore]}),s.jsx(u,{sx:{my:.5},children:n.breakdown.demographicFit.factors.slice(0,4).map(r=>s.jsxs(l,{variant:"caption",sx:{display:"block"},children:[r.value>=0?"âœ…":"âš ï¸"," ",r.reason," (",r.value>=0?"+":"",r.value,")"]},r.name))}),s.jsxs(l,{variant:"caption",sx:{fontWeight:700,mt:1,display:"block"},children:["Behavioral Engagement: ",n.breakdown.behavioralEngagement.score,"/",n.breakdown.behavioralEngagement.maxScore]}),s.jsx(u,{sx:{my:.5},children:n.breakdown.behavioralEngagement.factors.slice(0,4).map(r=>s.jsxs(l,{variant:"caption",sx:{display:"block"},children:["âœ… ",r.reason," (+",r.value,")"]},r.name))}),n.triggers.length>0&&s.jsxs(u,{sx:{mt:1},children:[s.jsx(l,{variant:"caption",sx:{fontWeight:700},children:"Triggers recentes"}),n.triggers.slice(0,3).map(r=>s.jsxs(l,{variant:"caption",sx:{display:"block"},children:[r.icon," ",r.event," (",We(r.timestamp),")"]},`${r.event}-${r.timestamp}`))]}),s.jsxs(l,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Ãšltima atualizaÃ§Ã£o: ",We(n.lastCalculatedAt)]})]}):s.jsx(u,{sx:{width:340,p:1.5},children:s.jsx(l,{variant:"body2",children:"Breakdown indisponÃ­vel"})}),Os=()=>{const n=ss(),[N]=as(),[S,b]=t.useState(!0),[r,w]=t.useState(null),[X,Ee]=t.useState([]),[L,Oe]=t.useState([]),[M,Pe]=t.useState([]),[R,y]=t.useState(0),[A,Fe]=t.useState(10),[Be,Me]=t.useState(0),[$,Re]=t.useState(""),[q,Ae]=t.useState(""),[V,$e]=t.useState(""),[H,qe]=t.useState(""),[Q,Y]=t.useState(""),[I,Ve]=t.useState([0,100]),[Z,ee]=t.useState({}),[se,ae]=t.useState({}),[He,te]=t.useState({}),[p,D]=t.useState(null),[_,ne]=t.useState(!1),[T,re]=t.useState(!0),[le,oe]=t.useState(""),[ie,ce]=t.useState(""),[de,ue]=t.useState("mql"),[E,me]=t.useState(!1),[he,xe]=t.useState(""),[je,ve]=t.useState(5e4),[pe,ge]=t.useState(""),[Qe,W]=t.useState(!1),[U,fe]=t.useState(!1),[O,be]=t.useState(null),[G,z]=t.useState({open:!1,message:"",severity:"info"}),[c,m]=t.useState({firstName:"",lastName:"",email:"",phone:"",company:"",jobTitle:"",source:"website",status:"new",ownerId:"",lifecycle:"lead",tags:[],customFields:{}}),ye=t.useMemo(()=>({search:$,status:q,source:V,lifecycle:Q,ownerId:H||void 0,scoreMin:I[0],scoreMax:I[1]}),[$,q,V,Q,H,I]);t.useEffect(()=>{const e=N.get("lifecycle");(e==="subscriber"||e==="lead"||e==="mql")&&Y(e)},[N]);const k=async()=>{var e,a;try{b(!0),w(null);const[o,P,es]=await Promise.all([g.leads.list(ye,R+1,A),g.users.list(),g.pipelines.list()]);Ee(((e=o.data)==null?void 0:e.data)||[]),Me(((a=o.data)==null?void 0:a.pagination.total)||0),Oe(P.data||[]),Pe(es.data||[])}catch(o){w(o instanceof Error?o.message:"Erro ao carregar leads")}finally{b(!1)}};t.useEffect(()=>{k()},[R,A,ye]),t.useEffect(()=>{!c.ownerId&&L[0]&&m(e=>({...e,ownerId:L[0].id}))},[L]);const _e=async e=>{if(!(Z[e]||se[e])){ae(a=>({...a,[e]:!0}));try{const a=await g.leads.getScoreDetails(e);a.data&&ee(o=>({...o,[e]:a.data}))}finally{ae(a=>({...a,[e]:!1}))}}},Ue=async e=>{te(a=>({...a,[e]:!0}));try{const a=await g.leads.recalculateScore(e);a.data&&ee(o=>({...o,[e]:a.data})),await k()}finally{te(a=>({...a,[e]:!1}))}},Ge=e=>{var a;D(e),re(!0),oe(e.company||""),ce(e.ownerId),ue("mql"),me(!1),xe(e.company?`Oportunidade - ${e.company}`:`Oportunidade - ${e.firstName} ${e.lastName}`),ge(((a=M[0])==null?void 0:a.id)||""),ve(5e4)},Je=async()=>{var e,a;if(p)try{ne(!0);const o={leadId:p.id,createAccount:T,accountName:T?le:void 0,ownerId:ie||p.ownerId,lifecycleStage:de,createDeal:E?{name:he,amount:Number(je)||0,pipelineId:pe||((e=M[0])==null?void 0:e.id)||""}:void 0},P=await g.leads.convert(o);D(null),await k(),z({open:!0,message:"Lead convertido com sucesso",severity:"success"}),(a=P.data)!=null&&a.contactId&&n(`/contacts/${P.data.contactId}`)}catch(o){w(o instanceof Error?o.message:"Erro ao converter lead")}finally{ne(!1)}},Ke=()=>{var e;be(null),m({firstName:"",lastName:"",email:"",phone:"",company:"",jobTitle:"",source:"website",status:"new",ownerId:((e=L[0])==null?void 0:e.id)||"",lifecycle:"lead",tags:[],customFields:{}}),W(!0)},Xe=e=>{be(e),m({firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone||"",company:e.company||"",jobTitle:e.jobTitle||"",source:e.source,status:e.status,ownerId:e.ownerId,lifecycle:e.lifecycle,tags:e.tags||[],customFields:e.customFields||{}}),W(!0)},Ye=async()=>{try{fe(!0),O?(await g.leads.update(O.id,c),z({open:!0,message:"Lead atualizado com sucesso",severity:"success"})):(await g.leads.create(c),z({open:!0,message:"Lead criado com sucesso",severity:"success"})),W(!1),await k()}catch(e){w(e instanceof Error?e.message:"Erro ao salvar lead")}finally{fe(!1)}},Ze=async e=>{if(e.isConverted){w("Lead convertido nÃ£o pode ser removido nesta etapa.");return}if(window.confirm(`Deseja remover o lead "${e.fullName}"?`))try{await g.leads.delete(e.id),await k(),z({open:!0,message:"Lead removido com sucesso",severity:"success"})}catch(a){w(a instanceof Error?a.message:"Erro ao excluir lead")}};return s.jsxs(u,{sx:{p:3},children:[s.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[s.jsxs(u,{children:[s.jsx(l,{variant:"h4",sx:{fontWeight:700},children:"ðŸŽ¯ Leads"}),s.jsx(l,{variant:"body2",color:"text.secondary",children:"GestÃ£o de leads com scoring, qualificaÃ§Ã£o e conversÃ£o para contato."})]}),s.jsx(f,{variant:"contained",startIcon:s.jsx(rs,{}),onClick:Ke,children:"Novo Lead"})]}),s.jsxs(Ce,{sx:{p:2,mb:2},children:[s.jsxs(C,{direction:{xs:"column",md:"row"},gap:2,children:[s.jsx(h,{size:"small",label:"Buscar",placeholder:"Nome, email, empresa...",value:$,onChange:e=>{y(0),Re(e.target.value)},sx:{minWidth:240}}),s.jsxs(x,{size:"small",sx:{minWidth:160},children:[s.jsx(j,{children:"Status"}),s.jsxs(v,{value:q,label:"Status",onChange:e=>{y(0),Ae(e.target.value)},children:[s.jsx(i,{value:"",children:"Todos"}),Te.map(([e,a])=>s.jsx(i,{value:e,children:a},e))]})]}),s.jsxs(x,{size:"small",sx:{minWidth:170},children:[s.jsx(j,{children:"Source"}),s.jsxs(v,{value:V,label:"Source",onChange:e=>{y(0),$e(e.target.value)},children:[s.jsx(i,{value:"",children:"Todos"}),ze.map(([e,a])=>s.jsx(i,{value:e,children:a},e))]})]}),s.jsxs(x,{size:"small",sx:{minWidth:200},children:[s.jsx(j,{children:"Owner"}),s.jsxs(v,{value:H,label:"Owner",onChange:e=>{y(0),qe(e.target.value)},children:[s.jsx(i,{value:"",children:"Todos"}),L.map(e=>s.jsx(i,{value:e.id,children:e.fullName},e.id))]})]}),s.jsxs(x,{size:"small",sx:{minWidth:150},children:[s.jsx(j,{children:"Lifecycle"}),s.jsxs(v,{value:Q,label:"Lifecycle",onChange:e=>{y(0),Y(e.target.value)},children:[s.jsx(i,{value:"",children:"Todos"}),s.jsx(i,{value:"subscriber",children:"Subscriber"}),s.jsx(i,{value:"lead",children:"Lead"}),s.jsx(i,{value:"mql",children:"MQL"})]})]})]}),s.jsxs(u,{sx:{mt:2,maxWidth:320},children:[s.jsxs(l,{variant:"caption",color:"text.secondary",children:["Faixa de score: ",I[0]," - ",I[1]]}),s.jsx(ls,{value:I,min:0,max:100,step:1,valueLabelDisplay:"auto",onChange:(e,a)=>{y(0),Ve(a)}})]})]}),r&&s.jsx(F,{severity:"error",sx:{mb:2},onClose:()=>w(null),children:r}),s.jsxs(is,{component:Ce,children:[s.jsxs(cs,{children:[s.jsx(ds,{sx:{bgcolor:"grey.50"},children:s.jsxs(B,{children:[s.jsx(d,{children:"Nome"}),s.jsx(d,{children:"Source"}),s.jsx(d,{children:"Score"}),s.jsx(d,{children:"Status"}),s.jsx(d,{children:"Owner"}),s.jsx(d,{align:"right",children:"AÃ§Ãµes"})]})}),s.jsx(us,{children:S?s.jsx(B,{children:s.jsx(d,{colSpan:6,align:"center",sx:{py:6},children:s.jsx(ts,{})})}):X.length===0?s.jsx(B,{children:s.jsx(d,{colSpan:6,align:"center",sx:{py:6},children:"Nenhum lead encontrado com os filtros atuais."})}):X.map(e=>{var o;const a=gs(e.leadScore);return s.jsxs(B,{hover:!0,children:[s.jsxs(d,{children:[s.jsx(l,{variant:"body2",sx:{fontWeight:600,cursor:"pointer",textDecoration:"underline"},onClick:()=>n(`/leads/${e.id}`),children:e.fullName}),s.jsxs(l,{variant:"caption",color:"text.secondary",children:[e.email," ",e.company?`â€¢ ${e.company}`:""]})]}),s.jsx(d,{children:ke[e.source]}),s.jsx(d,{children:s.jsx(ns,{placement:"bottom-start",enterDelay:200,arrow:!0,onOpen:()=>_e(e.id),title:s.jsx(fs,{details:Z[e.id],isLoading:!!se[e.id],onRecalculate:()=>Ue(e.id),recalculating:!!He[e.id]}),children:s.jsx(Se,{size:"small",color:a.color,label:`${e.leadScore} ${a.label}`})})}),s.jsx(d,{children:s.jsx(Se,{size:"small",variant:"outlined",label:e.isConverted?"âœ… Convertido":De[e.status],color:e.isConverted?"success":"default"})}),s.jsx(d,{children:((o=e.owner)==null?void 0:o.fullName)||"â€”"}),s.jsx(d,{align:"right",children:s.jsxs(C,{direction:"row",justifyContent:"flex-end",spacing:.5,children:[s.jsx(J,{size:"small",onClick:()=>n(`/leads/${e.id}`),children:s.jsx(ps,{fontSize:"small"})}),s.jsx(J,{size:"small",onClick:()=>Xe(e),disabled:e.isConverted,children:s.jsx(ms,{fontSize:"small"})}),s.jsx(J,{size:"small",color:"error",onClick:()=>Ze(e),disabled:e.isConverted,children:s.jsx(hs,{fontSize:"small"})}),s.jsx(f,{variant:"contained",size:"small",color:e.isConverted?"success":"primary",startIcon:s.jsx(vs,{}),disabled:e.isConverted,onClick:()=>Ge(e),children:e.isConverted?"Convertido":"Converter"})]})})]},e.id)})})]}),s.jsx(os,{component:"div",count:Be,rowsPerPage:A,page:R,onPageChange:(e,a)=>y(a),onRowsPerPageChange:e=>{Fe(Number(e.target.value)),y(0)},rowsPerPageOptions:[10,20,50],labelRowsPerPage:"Itens por pÃ¡gina"})]}),s.jsxs(we,{open:Qe,onClose:()=>W(!1),maxWidth:"sm",fullWidth:!0,children:[s.jsx(Le,{children:O?"Editar Lead":"Novo Lead"}),s.jsx(Ne,{children:s.jsxs(C,{spacing:2,sx:{mt:1},children:[s.jsxs(C,{direction:{xs:"column",md:"row"},spacing:1.5,children:[s.jsx(h,{size:"small",label:"Nome",value:c.firstName,onChange:e=>m(a=>({...a,firstName:e.target.value})),fullWidth:!0}),s.jsx(h,{size:"small",label:"Sobrenome",value:c.lastName,onChange:e=>m(a=>({...a,lastName:e.target.value})),fullWidth:!0})]}),s.jsx(h,{size:"small",label:"Email",value:c.email,onChange:e=>m(a=>({...a,email:e.target.value}))}),s.jsxs(C,{direction:{xs:"column",md:"row"},spacing:1.5,children:[s.jsx(h,{size:"small",label:"Telefone",value:c.phone||"",onChange:e=>m(a=>({...a,phone:e.target.value})),fullWidth:!0}),s.jsx(h,{size:"small",label:"Empresa",value:c.company||"",onChange:e=>m(a=>({...a,company:e.target.value})),fullWidth:!0})]}),s.jsx(h,{size:"small",label:"Cargo",value:c.jobTitle||"",onChange:e=>m(a=>({...a,jobTitle:e.target.value}))}),s.jsxs(C,{direction:{xs:"column",md:"row"},spacing:1.5,children:[s.jsxs(x,{size:"small",fullWidth:!0,children:[s.jsx(j,{children:"Source"}),s.jsx(v,{value:c.source,label:"Source",onChange:e=>m(a=>({...a,source:e.target.value})),children:ze.map(([e,a])=>s.jsx(i,{value:e,children:a},e))})]}),s.jsxs(x,{size:"small",fullWidth:!0,children:[s.jsx(j,{children:"Status"}),s.jsx(v,{value:c.status,label:"Status",onChange:e=>m(a=>({...a,status:e.target.value})),children:Te.map(([e,a])=>s.jsx(i,{value:e,children:a},e))})]})]}),s.jsxs(x,{size:"small",fullWidth:!0,children:[s.jsx(j,{children:"Owner"}),s.jsx(v,{value:c.ownerId,label:"Owner",onChange:e=>m(a=>({...a,ownerId:e.target.value})),children:L.map(e=>s.jsx(i,{value:e.id,children:e.fullName},e.id))})]})]})}),s.jsxs(Ie,{children:[s.jsx(f,{onClick:()=>W(!1),disabled:U,children:"Cancelar"}),s.jsx(f,{variant:"contained",onClick:Ye,disabled:U||!c.firstName.trim()||!c.lastName.trim()||!c.email.trim()||!c.ownerId,children:U?"Salvando...":O?"Salvar alteraÃ§Ãµes":"Criar lead"})]})]}),s.jsxs(we,{open:!!p,onClose:()=>D(null),maxWidth:"sm",fullWidth:!0,children:[s.jsx(Le,{children:"âœ¨ Converter Lead em Contact"}),s.jsx(Ne,{children:p&&s.jsxs(C,{spacing:2,sx:{mt:1},children:[s.jsxs(u,{children:[s.jsx(l,{variant:"body1",sx:{fontWeight:700},children:p.fullName}),s.jsxs(l,{variant:"body2",color:"text.secondary",children:[p.email," â€¢ Score ",p.leadScore]})]}),s.jsxs(x,{fullWidth:!0,size:"small",children:[s.jsx(j,{children:"Vendedor responsÃ¡vel"}),s.jsx(v,{label:"Vendedor responsÃ¡vel",value:ie,onChange:e=>ce(e.target.value),children:L.map(e=>s.jsx(i,{value:e.id,children:e.fullName},e.id))})]}),s.jsxs(x,{fullWidth:!0,size:"small",children:[s.jsx(j,{children:"Lifecycle do Contact"}),s.jsxs(v,{label:"Lifecycle do Contact",value:de,onChange:e=>ue(e.target.value),children:[s.jsx(i,{value:"mql",children:"MQL"}),s.jsx(i,{value:"sql",children:"SQL"})]})]}),s.jsxs(u,{sx:{display:"flex",gap:1},children:[s.jsx(f,{variant:T?"contained":"outlined",onClick:()=>re(e=>!e),children:T?"Conta: Sim":"Conta: NÃ£o"}),s.jsx(f,{variant:E?"contained":"outlined",onClick:()=>me(e=>!e),children:E?"Deal: Sim":"Deal: NÃ£o"})]}),T&&s.jsx(h,{size:"small",label:"Nome da conta",value:le,onChange:e=>oe(e.target.value)}),E&&s.jsxs(C,{direction:{xs:"column",md:"row"},gap:1.5,children:[s.jsx(h,{size:"small",label:"Nome do deal",value:he,onChange:e=>xe(e.target.value),fullWidth:!0}),s.jsx(h,{size:"small",label:"Valor",type:"number",value:je,onChange:e=>ve(Number(e.target.value))}),s.jsxs(x,{size:"small",sx:{minWidth:170},children:[s.jsx(j,{children:"Pipeline"}),s.jsx(v,{label:"Pipeline",value:pe,onChange:e=>ge(e.target.value),children:M.map(e=>s.jsx(i,{value:e.id,children:e.name},e.id))})]})]}),s.jsx(F,{severity:"info",children:"SerÃ£o transferidos para o contato: score, tags e campos customizados do lead."}),s.jsxs(F,{severity:"warning",children:["O lead serÃ¡ marcado como ",s.jsx("strong",{children:"Converted"})," e ficarÃ¡ read-only."]})]})}),s.jsxs(Ie,{children:[s.jsx(f,{onClick:()=>D(null),disabled:_,children:"Cancelar"}),s.jsx(f,{variant:"contained",onClick:Je,disabled:_||!p,children:_?"Convertendo...":"Converter Lead"})]})]}),s.jsx(xs,{open:G.open,autoHideDuration:2600,onClose:()=>z(e=>({...e,open:!1})),children:s.jsx(F,{severity:G.severity,onClose:()=>z(e=>({...e,open:!1})),sx:{width:"100%"},children:G.message})})]})};export{Os as default};
