import{r as o,j as e,B as c,T as t,P as y,b as h,F as b,I as C,S,m}from"./index-D1WZwRG5.js";import{B as u}from"./Button-BhZ-lD3l.js";import{A as P}from"./Alert-C2uN4Clt.js";import{C as D,a as W}from"./CardContent-C09eNwcx.js";import{S as d}from"./Stack-BDxuP9_X.js";import{C as p}from"./Chip-BcfuiGLT.js";import{D as R,a as E,b as B,c as q}from"./DialogTitle-CaeVllRe.js";import{M as l}from"./MenuItem-C9hTkJKZ.js";const F={reportId:"",reportName:"",enabled:!0,frequency:"weekly",time:"09:00",dayOfWeek:1,recipients:[],format:"pdf",subject:"",message:""},G=()=>{const[j,i]=o.useState(null),[g,w]=o.useState([]),[f,I]=o.useState([]),[k,x]=o.useState(!1),[s,n]=o.useState(F),v=async()=>{try{i(null);const[a,r]=await Promise.all([m.reportSchedules.list(),m.reportSchedules.logs()]);w(a.data||[]),I(r.data||[])}catch(a){i(a instanceof Error?a.message:"Erro ao carregar agendamentos")}};o.useEffect(()=>{v()},[]);const A=async()=>{try{if(!s.reportId||!s.reportName){i("Preencha reportId e nome do relatório");return}await m.reportSchedules.save({...s,recipients:s.recipients}),x(!1),n(F),await v()}catch(a){i(a instanceof Error?a.message:"Falha ao salvar agendamento")}};return e.jsxs(c,{sx:{p:3},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsxs(c,{children:[e.jsx(t,{variant:"h4",sx:{fontWeight:700},children:"Scheduled Reports"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Agendamento de relatórios por e-mail com histórico de execução."})]}),e.jsx(u,{variant:"contained",onClick:()=>x(!0),children:"Novo agendamento"})]}),j&&e.jsx(P,{severity:"error",sx:{mb:2},onClose:()=>i(null),children:j}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[e.jsx(D,{children:e.jsxs(W,{children:[e.jsx(t,{variant:"h6",sx:{mb:1},children:"Agendamentos ativos"}),e.jsx(d,{spacing:1,children:g.length===0?e.jsx(t,{variant:"body2",color:"text.secondary",children:"Nenhum agendamento cadastrado."}):g.map(a=>e.jsxs(y,{variant:"outlined",sx:{p:1.2},children:[e.jsx(t,{variant:"body2",sx:{fontWeight:700},children:a.reportName}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:[a.frequency," • ",a.time," • ",a.recipients.join(", ")]}),e.jsxs(d,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(p,{size:"small",label:a.enabled?"Ativo":"Pausado",color:a.enabled?"success":"default"}),e.jsx(p,{size:"small",label:`Próx: ${new Date(a.nextRunAt).toLocaleString("pt-BR")}`,variant:"outlined"})]})]},a.id))})]})}),e.jsx(D,{children:e.jsxs(W,{children:[e.jsx(t,{variant:"h6",sx:{mb:1},children:"Log de execuções"}),e.jsx(d,{spacing:1,children:f.length===0?e.jsx(t,{variant:"body2",color:"text.secondary",children:"Sem execuções registradas."}):f.slice(0,12).map(a=>e.jsxs(y,{variant:"outlined",sx:{p:1.2},children:[e.jsx(t,{variant:"body2",sx:{fontWeight:700},children:new Date(a.executedAt).toLocaleString("pt-BR")}),e.jsx(t,{variant:"caption",color:"text.secondary",children:a.message}),e.jsx(c,{sx:{mt:.5},children:e.jsx(p,{size:"small",label:a.status,color:a.status==="success"?"success":"error"})})]},a.id))})]})})]}),e.jsxs(R,{open:k,onClose:()=>x(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(E,{children:"Novo agendamento"}),e.jsx(B,{children:e.jsxs(d,{spacing:1.5,sx:{mt:.5},children:[e.jsx(h,{label:"Report ID",value:s.reportId,onChange:a=>n(r=>({...r,reportId:a.target.value})),fullWidth:!0}),e.jsx(h,{label:"Nome do relatório",value:s.reportName,onChange:a=>n(r=>({...r,reportName:a.target.value})),fullWidth:!0}),e.jsxs(d,{direction:{xs:"column",md:"row"},spacing:1.5,children:[e.jsxs(b,{fullWidth:!0,children:[e.jsx(C,{children:"Frequência"}),e.jsxs(S,{value:s.frequency,label:"Frequência",onChange:a=>n(r=>({...r,frequency:a.target.value})),children:[e.jsx(l,{value:"daily",children:"Diário"}),e.jsx(l,{value:"weekly",children:"Semanal"}),e.jsx(l,{value:"monthly",children:"Mensal"})]})]}),e.jsx(h,{label:"Horário",type:"time",value:s.time,onChange:a=>n(r=>({...r,time:a.target.value})),InputLabelProps:{shrink:!0},fullWidth:!0})]}),e.jsxs(b,{fullWidth:!0,children:[e.jsx(C,{children:"Formato"}),e.jsxs(S,{value:s.format,label:"Formato",onChange:a=>n(r=>({...r,format:a.target.value})),children:[e.jsx(l,{value:"pdf",children:"PDF"}),e.jsx(l,{value:"excel",children:"Excel"}),e.jsx(l,{value:"csv",children:"CSV"})]})]}),e.jsx(h,{label:"Destinatários (separados por vírgula)",value:s.recipients.join(", "),onChange:a=>n(r=>({...r,recipients:a.target.value.split(",").map(N=>N.trim()).filter(Boolean)})),fullWidth:!0})]})}),e.jsxs(q,{children:[e.jsx(u,{onClick:()=>x(!1),children:"Cancelar"}),e.jsx(u,{variant:"contained",onClick:A,children:"Salvar"})]})]})]})};export{G as default};
