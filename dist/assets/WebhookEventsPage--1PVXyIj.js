import{x as R,j as e,r,B as v,T as f,P as g,b as u,C as B,V as b,W as S,m as h}from"./index-D1WZwRG5.js";import{S as D}from"./Stack-BDxuP9_X.js";import{M as o}from"./MenuItem-C9hTkJKZ.js";import{B as C}from"./Button-BhZ-lD3l.js";import{T as E,a as A,b as V,c as p,d as a,e as F}from"./TableRow-CbZqZsXt.js";import{C as q}from"./Chip-BcfuiGLT.js";import{V as w}from"./Visibility-C5H_TSHc.js";import{D as G,a as H,b as L,c as M}from"./DialogTitle-CaeVllRe.js";import{S as O}from"./Snackbar-8yKmYgF-.js";import{A as J}from"./Alert-C2uN4Clt.js";const N=R(e.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"Replay"),ae=()=>{const[T,m]=r.useState(!0),[j,k]=r.useState([]),[l,y]=r.useState({connector:null,status:null,periodFrom:null,periodTo:null,query:"",page:1,pageSize:20}),[W,c]=r.useState(!1),[d,I]=r.useState(null),[i,n]=r.useState({open:!1,message:"",severity:"success"}),x=async()=>{var s;m(!0);try{const t=await h.paymentGateways.listWebhookEvents(l);k(((s=t.data)==null?void 0:s.data)||[])}catch(t){n({open:!0,message:t.message,severity:"error"})}finally{m(!1)}};r.useEffect(()=>{x()},[l]);const z=async s=>{try{const t=await h.paymentGateways.getWebhookPayload(s);I(t.data||null),c(!0)}catch(t){n({open:!0,message:t.message,severity:"error"})}},P=async s=>{try{const t=await h.paymentGateways.retryWebhookEvent(s);n({open:!0,message:t.message||"Reprocessado",severity:"success"}),x()}catch(t){n({open:!0,message:t.message,severity:"error"})}};return e.jsxs(v,{sx:{p:3},children:[e.jsx(f,{variant:"h4",fontWeight:700,sx:{mb:3},children:"Eventos de Webhook"}),e.jsx(g,{sx:{p:2,mb:2},children:e.jsxs(D,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsx(u,{size:"small",label:"Busca",value:l.query,onChange:s=>y({...l,query:s.target.value})}),e.jsxs(u,{size:"small",select:!0,label:"Status",value:l.status||"",onChange:s=>y({...l,status:s.target.value||null}),sx:{minWidth:160},children:[e.jsx(o,{value:"",children:"Todos"}),e.jsx(o,{value:"received",children:"received"}),e.jsx(o,{value:"processed",children:"processed"}),e.jsx(o,{value:"failed",children:"failed"}),e.jsx(o,{value:"retried",children:"retried"})]}),e.jsx(C,{variant:"outlined",onClick:x,children:"Atualizar"})]})}),T?e.jsx(v,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(B,{})}):e.jsx(E,{component:g,children:e.jsxs(A,{size:"small",children:[e.jsx(V,{children:e.jsxs(p,{children:[e.jsx(a,{children:"ID"}),e.jsx(a,{children:"Conector"}),e.jsx(a,{children:"Evento"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Tentativas"}),e.jsx(a,{children:"Recebido em"}),e.jsx(a,{align:"center",children:"Ações"})]})}),e.jsx(F,{children:j.length===0?e.jsx(p,{children:e.jsx(a,{colSpan:7,align:"center",children:e.jsx(f,{variant:"body2",color:"text.secondary",sx:{py:3},children:"Nenhum evento encontrado"})})}):j.map(s=>e.jsxs(p,{children:[e.jsxs(a,{children:[s.eventId.slice(0,10),"..."]}),e.jsx(a,{children:s.connector}),e.jsx(a,{children:s.eventType}),e.jsx(a,{children:e.jsx(q,{label:s.status,size:"small",color:s.status==="failed"?"error":s.status==="processed"?"success":"default"})}),e.jsx(a,{children:s.attempts}),e.jsx(a,{children:new Date(s.receivedAt).toLocaleString("pt-BR")}),e.jsxs(a,{align:"center",children:[e.jsx(b,{title:"Ver payload",children:e.jsx(S,{size:"small",onClick:()=>z(s.eventId),children:e.jsx(w,{fontSize:"small"})})}),e.jsx(b,{title:"Retry",children:e.jsx(S,{size:"small",onClick:()=>P(s.eventId),children:e.jsx(N,{fontSize:"small"})})})]})]},s.eventId))})]})}),e.jsxs(G,{open:W,onClose:()=>c(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(H,{children:"Payload mascarado"}),e.jsx(L,{children:e.jsx(u,{fullWidth:!0,multiline:!0,minRows:12,value:(d==null?void 0:d.maskedJson)||"",InputProps:{readOnly:!0}})}),e.jsx(M,{children:e.jsx(C,{onClick:()=>c(!1),children:"Fechar"})})]}),e.jsx(O,{open:i.open,autoHideDuration:3500,onClose:()=>n({...i,open:!1}),children:e.jsx(J,{severity:i.severity,variant:"filled",onClose:()=>n({...i,open:!1}),children:i.message})})]})};export{ae as default};
